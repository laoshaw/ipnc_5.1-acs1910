<html><head><title>module xdc.tools.repoman.Main</title>
<meta name="googlebot" content="noindex,nofollow">
<link rel="stylesheet" type="text/css" href="../../../src.css"/>
</head>
<body>
<pre class=src>
     1    <span class="comment">/* 
</span>     2    <span class="comment"> *Copyright (c) 2008 Texas Instruments and others.
</span>     3    <span class="comment"> *  All rights reserved. This program and the accompanying materials
</span>     4    <span class="comment"> *  are made available under the terms of the Eclipse Public License v1.0
</span>     5    <span class="comment"> *  which accompanies this distribution, and is available at
</span>     6    <span class="comment"> *  http://www.eclipse.org/legal/epl-v10.html
</span>     7    <span class="comment"> * 
</span>     8    <span class="comment"> *  Contributors:
</span>     9    <span class="comment"> *      Texas Instruments - initial implementation
</span>    10    <span class="comment"> *
</span>    11    <span class="comment"> * */</span>
    12    
    13    <span class=key>package</span> xdc.tools.repoman;
    14    
    15    <span class="xdoc">/*!
</span>    16    <span class="xdoc"> *  ======== xdc.tools.repoman.Main ========
</span>    17    <span class="xdoc"> *  Repository Manager tool
</span>    18    <span class="xdoc"> *
</span>    19    <span class="xdoc"> *  This tool creates and manages package repositories.  It displays
</span>    20    <span class="xdoc"> *  information about archived packages, extracts archived packages,
</span>    21    <span class="xdoc"> *  extracts repositories from bundles and deletes packages from
</span>    22    <span class="xdoc"> *  repositories.
</span>    23    <span class="xdoc"> *
</span>    24    <span class="xdoc"> *  Information about archived packages can be displayed with
</span>    25    <span class="xdoc"> *  the '-t' and '-n' options. The '-p' argument is used to 
</span>    26    <span class="xdoc"> *  specify a directory in which to search. If the '-p' arg is omitted,
</span>    27    <span class="xdoc"> *  the current directory is searched. Specific packages can searched
</span>    28    <span class="xdoc"> *  for by specifying one or more package names, or one or more package
</span>    29    <span class="xdoc"> *  archives at the end of the command line.  If no packages are specified,
</span>    30    <span class="xdoc"> *  information on all packages found in the search directory will be
</span>    31    <span class="xdoc"> *  displayed.
</span>    32    <span class="xdoc"> *  
</span>    33    <span class="xdoc"> *  Archived packages can be extracted to a repository with the '-x' 
</span>    34    <span class="xdoc"> *  option. '-x -D' will extract dependent packages, too. '-x -R' will
</span>    35    <span class="xdoc"> *  recursively extract dependent packages. If any of the packages in 
</span>    36    <span class="xdoc"> *  the specified package list are not compatible, the operation will
</span>    37    <span class="xdoc"> *  be aborted. '-F' can be used to force all packages to be extracted,
</span>    38    <span class="xdoc"> *  regardles of compatibility. The '-p' arg is used to specify a
</span>    39    <span class="xdoc"> *  directory to search in. If not specified, the current directory will
</span>    40    <span class="xdoc"> *  be searched. The '-x' option also extracts a repository or packages
</span>    41    <span class="xdoc"> *  from a bundle. In this case, the last argument specifies the bundle
</span>    42    <span class="xdoc"> *  from which to extract the repository. The repository to be extracted
</span>    43    <span class="xdoc"> *  is specified with the '-b' arg. If just packages are to be extracted,
</span>    44    <span class="xdoc"> *  one or more package names should follow the name of the repository
</span>    45    <span class="xdoc"> *  that they should be extracted from.
</span>    46    <span class="xdoc"> *
</span>    47    <span class="xdoc"> *  Packages can be deleted from a repository with '-d'. If the package
</span>    48    <span class="xdoc"> *  has any subdirectores that contain packages, they will be left intact.
</span>    49    <span class="xdoc"> *  After the package is deleted, if the package has no subdirectories
</span>    50    <span class="xdoc"> *  with packages, empty directories that are part of the fully qualified
</span>    51    <span class="xdoc"> *  package will be deleted, too.
</span>    52    <span class="xdoc"> *
</span>    53    <span class="xdoc"> *  Packages can be copied between repositories with '-c'. If the package
</span>    54    <span class="xdoc"> *  being copied already exists in the destination repository, it will be
</span>    55    <span class="xdoc"> *  deleted prior to being replaced.
</span>    56    <span class="xdoc"> *
</span>    57    <span class="xdoc"> *  The '-r' argument specifies a destination repository. If '-r' is
</span>    58    <span class="xdoc"> *  omitted, the repository of the current package is used. If there is
</span>    59    <span class="xdoc"> *  no current package, the current directory is used. 
</span>    60    <span class="xdoc"> *
</span>    61    <span class="xdoc"> *  When a package name is given, it can be specified in full, such as
</span>    62    <span class="xdoc"> *  'ti.platforms.sim6xxx', or the wildcard characters '*' and '?' may be
</span>    63    <span class="xdoc"> *  used, as in 'ti.platforms.*' or 'ti.catalog.c??00'. A version/key can
</span>    64    <span class="xdoc"> *  also be attached to a package name in the following manner:
</span>    65    <span class="xdoc"> *  'ti.platforms.c6000[1,0,0,0,313835]'.  A prefix of the full version/key
</span>    66    <span class="xdoc"> *  may also be used: 'ti.platforms.c6000[1,0]'.
</span>    67    <span class="xdoc"> *
</span>    68    <span class="xdoc"> *  If a package name has multiple matches either with or without a
</span>    69    <span class="xdoc"> *  version/key specified, the most recent will be selected. Wildcards may
</span>    70    <span class="xdoc"> *  also be used when naming a package archive file.
</span>    71    <span class="xdoc"> *  
</span>    72    <span class="xdoc"> *  <b>@a(Examples)</b>
</span>    73    <span class="xdoc"> *  xs xdc.tools.repoman -t
</span>    74    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>    75    <span class="xdoc"> *  Displays all info on all archived packages in the current directory
</span>    76    <span class="xdoc"> *  <b>@p</b>
</span>    77    <span class="xdoc"> *    
</span>    78    <span class="xdoc"> *  xs xdc.tools.repoman -t -p C:\xdc-o19\exports
</span>    79    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>    80    <span class="xdoc"> *  Displays all info on all archived packages in C:\xdc-o19\exports
</span>    81    <span class="xdoc"> *  <b>@p</b>
</span>    82    <span class="xdoc"> *
</span>    83    <span class="xdoc"> *  xs xdc.tools.repoman -t -p C:\xdc-o19\exports ti.platforms.*
</span>    84    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>    85    <span class="xdoc"> *  Displays all info on archived packages whose names begin with
</span>    86    <span class="xdoc"> *  ti.platforms. in C:\xdc-o19\exports
</span>    87    <span class="xdoc"> *  <b>@p</b>
</span>    88    <span class="xdoc"> *
</span>    89    <span class="xdoc"> *  xs xdc.tools.repoman -t -p C:\xdc-o19\exports ti_platforms*.tar
</span>    90    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>    91    <span class="xdoc"> *  Displays all info on packages in files that match ti_platforms*.tar
</span>    92    <span class="xdoc"> *  in C:\xdc-o19\exports
</span>    93    <span class="xdoc"> *  <b>@p</b>
</span>    94    <span class="xdoc"> * 
</span>    95    <span class="xdoc"> *  xs xdc.tools.repoman -t -p C:\xdc-o19\exports ti.catalog.c6000 ti.catalog.sim6xxx
</span>    96    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>    97    <span class="xdoc"> *  Displays all info on archived packages ti.catalog.c6000 and
</span>    98    <span class="xdoc"> *  ti.catalog.sim6xxx in C:\xdc-o19\exports
</span>    99    <span class="xdoc"> *  <b>@p</b>
</span>   100    <span class="xdoc"> * 
</span>   101    <span class="xdoc"> *  xs xdc.tools.repoman -x 
</span>   102    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   103    <span class="xdoc"> *  Extracts all archived packages in the current directory to the current
</span>   104    <span class="xdoc"> *  repository
</span>   105    <span class="xdoc"> *  <b>@p</b>
</span>   106    <span class="xdoc"> * 
</span>   107    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\myrepo\packages -p C:\exports
</span>   108    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   109    <span class="xdoc"> *  Extracts all archived packages in C:\exports to C:\myrepo\packages
</span>   110    <span class="xdoc"> *  repository
</span>   111    <span class="xdoc"> *  <b>@p</b>
</span>   112    <span class="xdoc"> * 
</span>   113    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\myrepo\packages -p C:\exports ti.catalog.*
</span>   114    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   115    <span class="xdoc"> *  Extracts packages matching ti.catalog.* from c:\exports to
</span>   116    <span class="xdoc"> *  c:\myrepo\packages
</span>   117    <span class="xdoc"> *  <b>@p</b>
</span>   118    <span class="xdoc"> * 
</span>   119    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\myrepo\packages C:\exports\ti_catalog*.tar
</span>   120    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   121    <span class="xdoc"> *  Extracts packages from files matching C:\exports\ti_catalog*.tar 
</span>   122    <span class="xdoc"> *  to c:\myrepo\packages
</span>   123    <span class="xdoc"> *  <b>@p</b>
</span>   124    <span class="xdoc"> * 
</span>   125    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\myrepo\packages C:\exports\ti_catalog*.tar
</span>   126    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   127    <span class="xdoc"> *  Extracts packages from files matching C:\exports\ti_catalog*.tar 
</span>   128    <span class="xdoc"> *  to c:\myrepo\packages
</span>   129    <span class="xdoc"> *  <b>@p</b>
</span>   130    <span class="xdoc"> *
</span>   131    <span class="xdoc"> *  xs xdc.tools.repoman -x -R -r C:\myrepo -p C:\xdc-o19\exports ti.platforms.sim6xxx
</span>   132    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   133    <span class="xdoc"> *  Extracts the package ti.platforms.sim6xxx and all recursively
</span>   134    <span class="xdoc"> *  dependent packages from C:\xdc-o19\exports to C:\myrepo
</span>   135    <span class="xdoc"> *  <b>@p</b>
</span>   136    <span class="xdoc"> * 
</span>   137    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\ -b packages C:\exports\xdc_core.tar.gz 
</span>   138    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   139    <span class="xdoc"> *  Extracts the repository 'packages' from bundle
</span>   140    <span class="xdoc"> *  C:\exports\xdc_core.tar.gz to C:\
</span>   141    <span class="xdoc"> *  <b>@p</b>
</span>   142    <span class="xdoc"> * 
</span>   143    <span class="xdoc"> *  xs xdc.tools.repoman -x -r C:\myrepo -b examples ti.xdais.dm.examples.videnc1_copy 
</span>   144    <span class="xdoc"> *  C:\xdais_6_24.tar.gz
</span>   145    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   146    <span class="xdoc"> *  Extracts the package ti.xdais.dm.examples.videnc1_copy from repository
</span>   147    <span class="xdoc"> *  'examples' in bundle
</span>   148    <span class="xdoc"> *  C:\xdais_6_24.tar.gz to C:\myrepo
</span>   149    <span class="xdoc"> *  <b>@p</b>
</span>   150    <span class="xdoc"> * 
</span>   151    <span class="xdoc"> *  xs xdc.tools.repoman -c -r C:\destdir\packages -p C:\srcdir\packages ti.catalog.c6000
</span>   152    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   153    <span class="xdoc"> *  Copies the package ti.catalog.c6000 from C:\srcdir\packages to
</span>   154    <span class="xdoc"> *  C:\destdir\packages
</span>   155    <span class="xdoc"> *  <b>@p</b>
</span>   156    <span class="xdoc"> *
</span>   157    <span class="xdoc"> *  xs xdc.tools.repoman --rsave -f c:/repoinfo.rmn -p c:/pkgarchives;c:/testpkgs c:/myrepo 
</span>   158    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   159    <span class="xdoc"> *  Saves package information for repository c:/myrepo to file c:/repoinfo.rmn.
</span>   160    <span class="xdoc"> *  Also saves the search path c:/pkgarchives;c:/testpkgs
</span>   161    <span class="xdoc"> *  <b>@p</b>
</span>   162    <span class="xdoc"> *
</span>   163    <span class="xdoc"> *  xs xdc.tools.repoman --rrestore -f c:/repoinfo.rmn -p c:/pkgarchives;c:/testpkgs
</span>   164    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   165    <span class="xdoc"> *  Restores all of the packages in the repository referenced in
</span>   166    <span class="xdoc"> *  c:/repoinfo.rmn. Uses the search path c:/pkgarchives;c:/testpkgs to find
</span>   167    <span class="xdoc"> *  and copy packages. Will create the repository if it doesn't exist.
</span>   168    <span class="xdoc"> *  <b>@p</b>
</span>   169    <span class="xdoc"> *
</span>   170    <span class="xdoc"> *  xs xdc.tools.repoman --rcreate -f c:/repoinfo.rmn -p
</span>   171    <span class="xdoc"> *                       c:/pkgarchives;c:/testpkgs c:/mynewrepo
</span>   172    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   173    <span class="xdoc"> *  Creates the new repository c:/mynewrepo from the repository referenced in
</span>   174    <span class="xdoc"> *  the file c:/repoinfo.rmn.  Uses the search path c:/pkgarchives;c:/testpkgs
</span>   175    <span class="xdoc"> *  to find and copy packages. If successful, the newly created repository
</span>   176    <span class="xdoc"> *  will be identical to its predecessor referenced in c:/repoinfo.rmn.
</span>   177    <span class="xdoc"> *  <b>@p</b>
</span>   178    <span class="xdoc"> *
</span>   179    <span class="xdoc"> *  xs xdc.tools.repoman --providerId my_codec_engine c:/codec_engine_2_23/mypackages
</span>   180    <span class="xdoc"> *  <b>@p(dlist)</b>
</span>   181    <span class="xdoc"> *  Assigns the providerId attribute in  c:/codec_engine_2_23/mypackages/.repo.xml
</span>   182    <span class="xdoc"> *  the value my_codec_engine. If c:/codec_engine_2_23/mypackages/.repo.xml does not
</span>   183    <span class="xdoc"> *  exist, it will be created.
</span>   184    <span class="xdoc"> *  <b>@p</b>
</span>   185    <span class="xdoc"> *
</span>   186    <span class="xdoc"> */</span>
   187    <span class=key>metaonly</span> <span class=key>module</span> Main <span class=key>inherits</span> xdc.tools.ICmd {
   188    
   189        <span class=key>override</span> <span class=key>config</span> String usage[] = [
   190            <span class="string">'-t [-v] [-p pathname] [packagename...|packagefile...]'</span>,
   191            <span class="string">'-n [-v] [-p pathname] [packagename...|packagefile...]'</span>,
   192            <span class="string">'-x [-v] [-D] [-R] [-F] [-r destrepo] [-p path] packagename...|packagefile...'</span>,
   193            <span class="string">'-x [-v] [-D] [-R] [-F] [-r destrepo] [-p path] -b bundlerepository [packagename...] bundleFile'</span>,
   194            <span class="string">'-d [-v] [-F] [-r destrepo] packagename...'</span>,
   195            <span class="string">'-c [-v] [-F] [--providerId] [-r destrepo] [-p pathname] packagename...'</span>,
   196            <span class="string">'--rsave -f file [-p searchpath] repository...'</span>,
   197            <span class="string">'--rrestore -f file [-p searchpath] [index-spec]'</span>,
   198            <span class="string">'--rcreate -f file [-p searchpath] [index-spec] destrepository...'</span>,
   199            <span class="string">'[-F] --providerId providerId [repository...]'</span>
   200        ];
   201    
   202       <span class="xdoc">/*! represents a repository in a bundle */</span>
   203        @XmlDtd 
   204        <span class=key>metaonly</span> <span class=key>struct</span> Repo {
   205            String name;
   206            String pkg[];
   207        }
   208    
   209        @XmlDtd
   210        <span class=key>metaonly</span> <span class=key>struct</span> Pkg {
   211            String name;
   212            String file;
   213            String release;
   214            String label;
   215            String version;
   216            String date;
   217            String buildable;
   218            String reqs[];
   219            String refs[];
   220            Repo repository[];
   221        }
   222       
   223        @XmlDtd
   224        <span class=key>metaonly</span> <span class=key>struct</span> Results {
   225            String repository;
   226            String providerId;
   227            String producerId;
   228            Bool writable;
   229            Pkg pkg[];         <span class="xdoc">/*! array of package info structures */</span>
   230        }
   231    
   232        @XmlDtd
   233        <span class=key>metaonly</span> <span class=key>struct</span> PkgName {
   234            String name;
   235            Repo repository[];
   236        }
   237    
   238        @XmlDtd
   239        <span class=key>metaonly</span> <span class=key>struct</span> NameResults {
   240            PkgName pkgName[];     <span class="xdoc">/*! array of PkgName structures */</span>
   241        }
   242    
   243    <span class=key>instance</span>:
   244    
   245        <span class=xdoc>//!Display package info</span>
   246        @CommandOption(<span class="string">'t'</span>)
   247        <span class=key>config</span> Bool infoFlag = <span class=key>false</span>;
   248    
   249        <span class=xdoc>//!Display package names only</span>
   250        @CommandOption(<span class="string">'n'</span>)
   251        <span class=key>config</span> Bool namesFlag = <span class=key>false</span>;
   252    
   253        <span class=xdoc>//!Extract package(s)</span>
   254        @CommandOption(<span class="string">'x'</span>)
   255        <span class=key>config</span> Bool extractFlag = <span class=key>false</span>;
   256    
   257        <span class=xdoc>//!Delete package(s)</span>
   258        @CommandOption(<span class="string">'d'</span>)
   259        <span class=key>config</span> Bool deleteFlag = <span class=key>false</span>;
   260    
   261        <span class=xdoc>//!Path arg</span>
   262        @CommandOption(<span class="string">'p'</span>)
   263        <span class=key>config</span> String pathArg = <span class=key>null</span>;
   264    
   265        <span class=xdoc>//!Repository arg</span>
   266        @CommandOption(<span class="string">'r'</span>)
   267        <span class=key>config</span> String repositoryArg = <span class=key>null</span>;
   268    
   269        <span class=xdoc>//!Include package dependencies</span>
   270        @CommandOption(<span class="string">'D'</span>)
   271        <span class=key>config</span> Bool dependentFlag = <span class=key>false</span>;
   272    
   273        <span class=xdoc>//!Recursive include package dependencies</span>
   274        @CommandOption(<span class="string">'R'</span>)
   275        <span class=key>config</span> Bool recursiveDepFlag = <span class=key>false</span>;
   276    
   277        <span class=xdoc>//!Return an array of strings</span>
   278        @CommandOption(<span class="string">'a'</span>)
   279        <span class=key>config</span> Bool arrFlag = <span class=key>false</span>;
   280    
   281        <span class=xdoc>//!Return a Results struct as XML</span>
   282        @CommandOption(<span class="string">'X'</span>)
   283        <span class=key>config</span> Bool xmlFlag = <span class=key>false</span>;
   284    
   285        <span class=xdoc>//!Print informative messages during execution</span>
   286        @CommandOption(<span class="string">'v'</span>)
   287        <span class=key>config</span> Bool verboseFlag = <span class=key>false</span>;
   288    
   289        <span class=xdoc>//!Bundle repository arg</span>
   290        @CommandOption(<span class="string">'b'</span>)
   291        <span class=key>config</span> String bundleRepositoryArg = <span class=key>null</span>;
   292    
   293        <span class=xdoc>//!Force incompatible packages</span>
   294        @CommandOption(<span class="string">'F'</span>)
   295        <span class=key>config</span> Bool forceFlag = <span class=key>false</span>;
   296    
   297        <span class=xdoc>//!Copy package(s)</span>
   298        @CommandOption(<span class="string">'c'</span>)
   299        <span class=key>config</span> Bool copyFlag = <span class=key>false</span>;
   300    
   301        <span class=xdoc>//!file arg to save/restore repository</span>
   302        @CommandOption(<span class="string">'f'</span>)
   303        <span class=key>config</span> String fileArg = <span class=key>null</span>;
   304    
   305        <span class=xdoc>//!Save a repository's information to file</span>
   306        @CommandOption(<span class="string">'rsave'</span>)
   307        <span class=key>config</span> Bool rsaveFlag = <span class=key>false</span>;
   308    
   309        <span class=xdoc>//!Restore one or more repositories from information in file</span>
   310        @CommandOption(<span class="string">'rrestore'</span>)
   311        <span class=key>config</span> Bool rrestoreFlag = <span class=key>false</span>;
   312    
   313        <span class=xdoc>//!Create one or more repositories from information in file</span>
   314        @CommandOption(<span class="string">'rcreate'</span>)
   315        <span class=key>config</span> Bool rcreateFlag = <span class=key>false</span>;
   316    
   317        <span class=xdoc>//! providerId for a repository</span>
   318        @CommandOption(<span class="string">'providerId'</span>)
   319        <span class=key>config</span> string provIdArg = <span class=key>null</span>;
   320    
   321    }
   322    
   323    
   324    
   325    <span class="comment">/*
</span>   326    <span class="comment"> *  @(#) xdc.tools.repoman; 1, 0, 0, 0,147; 11-20-2009 13:27:53; /db/ztree/library/trees/xdctools/xdctools-d08x/src/
</span>   327    <span class="comment"> */</span>
   328    
</pre>
</body></html>
