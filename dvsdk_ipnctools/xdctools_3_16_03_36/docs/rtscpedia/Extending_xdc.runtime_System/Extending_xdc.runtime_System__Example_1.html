<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
				<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="mediawiki-tip/opensearch_desc.php" title="RTSC-Pedia (English)" />
		<title>Extending xdc.runtime System/Example 1 - Offline Version</title>
		<style type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "../common/skins/common/shared.css";
			@import "../common/skins/monobook/main.css";
		/*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="../common/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "../common/skins/monobook/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "../common/skins/monobook/IE70Fixes.css";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="../common/skins/common/IEFixes.js?97"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		
		<script type= "text/javascript">/*<![CDATA[*/
var skin = "monobook";
var stylepath = "../common/skins";
var wgArticlePath = "/docs-tip/$1";
var wgScriptPath = "mediawiki-tip";
var wgScript = "mediawiki-tip/index.php";
var wgServer = "http://rtsc.eclipse.org";
var wgCanonicalNamespace = "Special";
var wgCanonicalSpecialPageName = "Offline";
var wgNamespaceNumber = -1;
var wgPageName = "Special:Offline";
var wgTitle = "Offline";
var wgAction = "view";
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
var wgArticleId = 0;
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = 0;
/*]]>*/</script>
                
		<script type="text/javascript" src="../common/skins/common/wikibits.js?97"><!-- wikibits js --></script>
		<script type="text/javascript" src="mediawiki-tip/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "mediawiki-tip/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
<link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/ViewStyle.css" /><link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/MainStyle.css" />
	</head>
<body  class="mediawiki ns--1 ltr page-Special_Offline">
	<div id="globalWrapper" align="center">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading"></h1>
		<div id="bodyContent">
			<h3 id="siteSub">From RTSC-Pedia</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content --><div id="revInfo">revision tip</div><span id="printInfo">&#151;&#151;&nbsp;LANDSCAPE orientation</span><table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/yellow_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=Extending xdc.runtime System/Example 1&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="Extending_xdc.runtime_System.html#TOC" title="Extending xdc.runtime System"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a></td></tr></table><p id="title">Extending xdc.runtime System/Example 1</p><p id="subtitle">A minimal <tt>System</tt> support module for tiny systems</p>
<p></p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#A_Minimal_ISystemSupport_Module"><span class="tocnumber">1</span> <span class="toctext">A Minimal ISystemSupport Module</span></a></li>
<li class="toclevel-1"><a href="#Using_SysBuf"><span class="tocnumber">2</span> <span class="toctext">Using SysBuf</span></a></li>
<li class="toclevel-1"><a href="#Implementation_of_SysBuf"><span class="tocnumber">3</span> <span class="toctext">Implementation of SysBuf</span></a>
<ul>
<li class="toclevel-2"><a href="#The_SysBuf_Module"><span class="tocnumber">3.1</span> <span class="toctext">The SysBuf Module</span></a></li>
<li class="toclevel-2"><a href="#The_Package_Files"><span class="tocnumber">3.2</span> <span class="toctext">The Package Files</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="A_Minimal_ISystemSupport_Module"></a><h2> <span class="mw-headline">A Minimal <tt>ISystemSupport</tt> Module</span></h2>
<p>In this section we show the <i>complete</i> implementation of a package that includes a module, named <tt>SysBuf</tt>, that provides the "backend" services required by the <tt>xdc.runtime.System</tt> module.  This example serves two purposes:
</p>
<ol><li>illustrate how to create a simple "system support" module, and
</li><li>provide a small footprint <tt>System</tt> support module appropriate for deeply embedded multi-threaded systems.
</li></ol>
<p><tt>System</tt> support modules are responsible for handling character output (generated from say <tt>System_printf()</tt>) as well as providing extensions to the <tt>System_exit()</tt> and <tt>System_abort()</tt> application termination process.  The <tt>SysBuf</tt> module simply records each output character into a circular buffer (which is sized and placed at configuration time), and extends <tt>System_abort()</tt> by copying a termination message into the output buffer just prior to termination.
</p>
<a name="Using_SysBuf"></a><h2> <span class="mw-headline">Using <tt>SysBuf</tt></span></h2>
<p>To illustrate the use of the <tt>ISystemSupport</tt> module <tt>SysBuf</tt>, we start with the "hello world" example from <a href="../Using_xdc.runtime_System/Using_xdc.runtime_System__Example_1.html" title="Using xdc.runtime System/Example 1">Using xdc.runtime System/Example 1</a> and add two lines to the application's configuration script.  These statements (denoted by <a class="codexLink" href="#cl-hello_config1:+"><span class="codexLink">+</span></a> below) simply declare that we want to use <tt>SysBuf</tt> as the <tt>System</tt> module's "support proxy" in lieu of the default, <tt>SysMin</tt>.
</p>
<table>

<tr valign="top">
<td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>hello.c</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="c"><span class="re1">#include</span> <span class="re2">&lt;xdc/std.h&gt;</span>
&nbsp;
<span class="re1">#include</span> <span class="re2">&lt;xdc/runtime/System.h&gt;</span>
&nbsp;
<span class="coMULTI">/*  ======== main ======== */</span>
<span class="kw2">Int</span> main<span class="br0">&#40;</span><span class="kw2">Int</span> argc, <span class="kw2">String</span> argv<span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    System_printf<span class="br0">&#40;</span><span class="st0">&quot;hello world<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span>;
    <span class="kw1">return</span> <span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
</td><td><div id="cl-1:+"></div><div id="cl-hello_config1:+"></div><div id="cl-1:+"></div><div id="cl-hello_config1:+"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>hello.cfg</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br /><span class="codexLab">+</span><br /><span class="codexLab">+</span><br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> System = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st0">&quot;xdc.runtime.System&quot;</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> SysBuf = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st0">&quot;xdc.runtime.SysBuf&quot;</span><span class="br0">&#41;</span>;
System.SupportProxy = SysBuf;</pre></td></tr></table>
</td></tr></table>
<p>When we run this application no output is displayed; the output from the call to <tt>System_printf</tt> is simply written to the buffer managed by <tt>SysBuf</tt>.  The only way to view the output is to examine the contents of this buffer.  While this is ridiculously onerous when developing applications for platforms with a high-level operating system (such as Linux or WinCE), it can be a life saver when developing low-level bootstrap code for these platforms, code targeted for  platforms without character output facilities, or device driver code for character output peripherals.
</p><p>As we'll see in the implementation of <tt>SysBuf</tt> below, this module defines a global variable that makes it relatively easy to display the contents of the buffer from a modern graphical debugger.  By default, <tt>SysBuf</tt> defines a global variable named <tt>SYSBUF</tt> that contains a pointer to the character output buffer.
</p>
<center><a href="images/SysBuf.PNG" class="image" title="Image:SysBuf.PNG"><img alt="Image:SysBuf.PNG" src="images/SysBuf.PNG" width="730" height="471" border="0" /></a></center>
<p>You can configure the name of the global variable containing the pointer to the output buffer, the size of the output buffer, and even the output section where the output buffer is placed.  For example, by adding more two lines to the configuration script (indicated by <a class="codexLink" href="#cl-hello_config2:+"><span class="codexLink">+</span></a>), the configuration script below defines the global variable name to be <tt>STDOUT</tt> and sets the output buffer size to be just 256 characters.
</p>
<div id="cl-2:+"></div><div id="cl-hello_config2:+"></div><div id="cl-2:+"></div><div id="cl-hello_config2:+"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>hello.cfg</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">+</span><br /><span class="codexLab">+</span><br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> System = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st0">&quot;xdc.runtime.System&quot;</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> SysBuf = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st0">&quot;xdc.runtime.SysBuf&quot;</span><span class="br0">&#41;</span>;
System.SupportProxy = SysBuf;
SysBuf.bufName = <span class="st0">&quot;STDOUT&quot;</span>;
SysBuf.bufSize = <span class="nu0">256</span>;</pre></td></tr></table>
<a name="Implementation_of_SysBuf"></a><h2> <span class="mw-headline">Implementation of <tt>SysBuf</tt></span></h2>
<p>In this section we show the entire implementation of the <tt>SysBuf</tt> module as well as all package files necessary to build and deliver the <tt>SysBuf</tt> module to anyone wishing to use it.
</p>
<a name="The_SysBuf_Module"></a><h3> <span class="mw-headline">The <tt>SysBuf</tt> Module</span></h3>
<p>The <tt>SysBuf</tt> module implements the <tt>ISystemSupport</tt> interface but makes minimal assumptions about underlying platform capabilities.  In particular, it handles all character output by simply writing all output to a "global" buffer managed by <tt>SysBuf</tt>.
</p>
<div id="cl-3:1"></div><div id="cl-SysBuf_spec:1"></div><div id="cl-3:2"></div><div id="cl-SysBuf_spec:2"></div><div id="cl-3:3"></div><div id="cl-SysBuf_spec:3"></div><div id="cl-3:4"></div><div id="cl-SysBuf_spec:4"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>SysBuf.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="kw1">module</span> SysBuf <span class="kw1">inherits</span> xdc.runtime.ISystemSupport <span class="br0">&#123;</span>
&nbsp;
    <span class="xdoc">/*!
     *  ======== bufName =========
     *  The name of a variable that points to the buffer
     */</span>
    <span class="kw1">metaonly</span> <span class="kw1">config</span> bufName = <span class="st0">&quot;SYSBUF&quot;</span>;
&nbsp;
    <span class="xdoc">/*!
     *  ======== bufSize ========
     *  Size (in MAUs) of the internal buffer where all output is stored
     */</span>
    <span class="kw1">config</span> SizeT bufSize = <span class="nu0">1024</span>;
&nbsp;
    <span class="xdoc">/*!
     *  ======== sectionName ========
     *  Section where the internal buffer managed by SysBuf is placed.
     */</span>
    <span class="kw1">metaonly</span> <span class="kw1">config</span> <span class="kw2">String</span> sectionName = <span class="kw1">null</span>;
&nbsp;
<span class="kw1">internal</span>:
    <span class="kw1">struct</span> Module_State <span class="br0">&#123;</span>
        <span class="kw2">Char</span> outbuf<span class="br0">&#91;</span><span class="br0">&#93;</span>;  <span class="coMULTI">/* output buffer */</span>
        <span class="kw2">UInt</span> outidx;    <span class="coMULTI">/* index of next available output character */</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></table>
<p>As you can see from <tt>SysBuf</tt>s specification, the size and placement of the output buffer can be configured by the end-user; <a class="codexLink" href="#cl-SysBuf_spec:2"><span class="codexLink">2</span></a> and <a class="codexLink" href="#cl-SysBuf_spec:3"><span class="codexLink">3</span></a> respectively.  The <tt>bufName</tt> metaonly configuration parameter <a class="codexLink" href="#cl-SysBuf_spec:1"><span class="codexLink">1</span></a> allows you control the name of a global variable used to hold the pointer to the output buffer.  This global variable's only purpose is to make it easy to display this buffer from an attached debugger.  By making it a configuration parameter, the system integrator can control the name of this global variable <i>without having to modify the sources</i> of the <tt>SysBuf</tt> module; different applications can use different names (e.g., to avoid clashes with other global variables) and still use exactly the same <i>pre-compiled</i> <tt>SysBuf</tt> module.
</p>
<table>

<tr valign="top">
<td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>SysBuf.c</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="c"><span class="re1">#include</span> <span class="re2">&lt;xdc/std.h&gt;</span>
&nbsp;
<span class="re1">#include</span> <span class="re2">&lt;xdc/runtime/Gate.h&gt;</span>
<span class="re1">#include</span> <span class="st0">&quot;package/internal/SysBuf.xdc.h&quot;</span>
&nbsp;
<span class="coMULTI">/* ======== SysBuf_abort ======== */</span>
<span class="kw2">Void</span> SysBuf_abort<span class="br0">&#40;</span><span class="kw2">String</span> str<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>SysBuf_bufSize&nbsp;!= <span class="nu0">0</span> &amp;&amp; str&nbsp;!= <span class="kw2">NULL</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw2">Char</span> ch;
        <span class="kw1">while</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>ch = *str++<span class="br0">&#41;</span>&nbsp;!= <span class="st0">'<span class="es0">\0</span>'</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            SysBuf_putch<span class="br0">&#40;</span>ch<span class="br0">&#41;</span>;
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* ======== SysBuf_exit ======== */</span>
<span class="kw2">Void</span> SysBuf_exit<span class="br0">&#40;</span><span class="kw2">Int</span> stat<span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="coMULTI">/* do nothing */</span><span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* ======== SysBuf_flush ======== */</span>
<span class="kw2">Void</span> SysBuf_flush<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="coMULTI">/* nothing to do */</span><span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* ======== SysBuf_putch ======== */</span>
<span class="kw2">Void</span> SysBuf_putch<span class="br0">&#40;</span><span class="kw2">Char</span> ch<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>SysBuf_bufSize&nbsp;!= <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        IArg key = Gate_enterSystem<span class="br0">&#40;</span><span class="br0">&#41;</span>;
        <span class="kw1">if</span> <span class="br0">&#40;</span>module-&gt;outidx &gt;= SysBuf_bufSize<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            module-&gt;outidx = <span class="nu0">0</span>;
        <span class="br0">&#125;</span>
        module-&gt;outbuf<span class="br0">&#91;</span>module-&gt;outidx++<span class="br0">&#93;</span> = ch;
        Gate_leaveSystem<span class="br0">&#40;</span>key<span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* ======== SysBuf_ready ======== */</span>
<span class="kw2">Bool</span> SysBuf_ready<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="br0">&#40;</span>SysBuf_bufSize&nbsp;!= <span class="nu0">0</span>&nbsp;? TRUE&nbsp;: FALSE<span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
</td><td><div id="cl-4:a"></div><div id="cl-SysBuf_meta:a"></div><div id="cl-4:b"></div><div id="cl-SysBuf_meta:b"></div><div id="cl-4:c"></div><div id="cl-SysBuf_meta:c"></div><div id="cl-4:d"></div><div id="cl-SysBuf_meta:d"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>SysBuf.xs</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">a</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">b</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">c</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">d</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Memory = <span class="kw2">null</span>;
&nbsp;
<span class="coMULTI">/* ======== module$static$init ======== */</span>
<span class="kw1">function</span> module$static$init<span class="br0">&#40;</span>obj, mod<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="coMULTI">/* set size of SysBuf's output buffer, outbuf */</span>
    obj.outbuf.length = mod.bufSize;
&nbsp;
    <span class="coMULTI">/* specify alignment and placement of outbuf */</span>
    Memory.staticPlace<span class="br0">&#40;</span>obj.outbuf, 
        <span class="nu0">0</span>, mod.sectionName<span class="br0">&#41;</span>;
&nbsp;
    <span class="coMULTI">/* initialize output index state */</span>
    obj.outidx = <span class="nu0">0</span>;
&nbsp;
    <span class="coMULTI">/* initialize output buffer */</span>
    <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw1">var</span> i = <span class="nu0">0</span>; i &lt; obj.outbuf.length; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        obj.outbuf<span class="br0">&#91;</span>i<span class="br0">&#93;</span> = <span class="nu0">0</span>;
    <span class="br0">&#125;</span>
&nbsp;
    <span class="coMULTI">/* optionally define variable to easily read buf */</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>mod.bufName&nbsp;!= <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Program.global<span class="br0">&#91;</span>mod.bufName<span class="br0">&#93;</span> = obj.buf;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* ======== module$use ======== */</span>
<span class="kw1">function</span> module$use<span class="br0">&#40;</span>obj, mod<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    Memory = <span class="re1">xdc.module</span><span class="br0">&#40;</span><span class="st1">'xdc.runtime.Memory'</span><span class="br0">&#41;</span>;
    <span class="re1">xdc.module</span><span class="br0">&#40;</span><span class="st1">'xdc.runtime.Gate'</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
</td></tr></table>
<p>The C implementation of the <tt>ISystemSupport</tt> interface, <tt>SysBuf.c</tt>, is fairly straight forward.  Perhaps the only comment worth making is about the implementation of the <tt>putch</tt> function, a function that handles <i>every</i> character output by the <tt>System</tt> module's methods.  This implementation, although 100% portable ANSI C and thread-safe, is somewhat heavyweight for the output of a single character.  In most cases it is possible (and easy) to greatly reduce the overhead of this function by taking advantage of device-specific instructions to "atomically" update the circular output buffer.
</p><p>What makes the implementation of <tt>SysBuf</tt> interesting is not so much the code that's in <tt>SysBuf.c</tt>, rather it's the code that's <i>not</i> in <tt>SysBuf.c</tt>.   Since RTSC modules can declare a "state" structure that is initialized by the module's meta-domain function <tt><a href="../XDCscript_-_Module-Body.module%24static%24init/XDCscript_-_Module-Body.module%24static%24init.html" title="XDCscript - Module-Body.module$static$init">module$static$init()</a></tt> and  accessible by target code, there is no need to allocate or initialize the output buffer in <tt>SysBuf.c</tt>,  no need to declare the global variable <tt>SYSBUF</tt>, nor is it necessary to recompile <tt>SysBuf.c</tt> to support different buffer sizes; <a href="../RTSC_Module_Primer/RTSC_Module_Primer__Lesson_7.html" title="RTSC Module Primer/Lesson 7">RTSC Module Primer Lesson 7</a> contains another example leveraging <tt>Module_State</tt> and a complete discussion of this aspect of RTSC modules.  
</p><p>In this case, <tt>module$static$init()</tt> is passed two parameters: <tt>obj</tt> - an object that corresponds to the <tt>Module_State</tt> declaration in <tt>SysBuf.xdc</tt> <a class="codexLink" href="#cl-SysBuf_spec:4"><span class="codexLink">4</span></a>, and <tt>mod</tt> - a reference to the current module object that in turn contains all of the module-wide configuration parameters.  By initializing <tt>obj</tt> in this method, corresponding values will be used to initialize the <tt>SysBuf</tt> module's state data on the target <i>before the target code even begins to run</i>.  In outline, this function
</p>
<dl><dd><a class="codexLink" href="#cl-SysBuf_meta:a"><span class="codexLink">a</span></a>  allocates a static buffer by setting the length of the <tt>outbuf</tt> array declared by <tt>SysBuf.xdc</tt>;
</dd><dd><a class="codexLink" href="#cl-SysBuf_meta:b"><span class="codexLink">b</span></a>  uses <tt><a href="../../cdoc/xdc/runtime/Memory.html#static.Place" class="cdoc"><tt>Memory.staticPlace()</tt></a></tt> to identify the section where this buffer should be placed and how it should be aligned by the linker; 
</dd><dd><a class="codexLink" href="#cl-SysBuf_meta:c"><span class="codexLink">c</span></a> initializes the buffer with values that will be seen by the initial code running on the target; and finally
</dd><dd><a class="codexLink" href="#cl-SysBuf_meta:d"><span class="codexLink">d</span></a>  uses <tt><a href="../../cdoc/xdc/cfg/Program.html#global" class="cdoc"><tt>Program.global</tt></a></tt> to define the global variable, whose name is declared at <a class="codexLink" href="#cl-SysBuf_spec:1"><span class="codexLink">1</span></a> in the specification of <tt>SysBuf</tt>, that makes it easy to view this output buffer from a debugger.  The name is configurable to allow the user to either change the name to avoid clashes with existing code or to optionally not define any variable (by setting <tt>bufName</tt> to <tt>null</tt>).
</dd></dl>
<a name="The_Package_Files"></a><h3> <span class="mw-headline">The Package Files</span></h3>
<p>Since all modules must live in a package we also need to create a two other files:
</p>
<ol><li><tt>package.xdc</tt> - a file that define the package's name and identifies the modules it contains, and
</li><li><tt>package.bld</tt> - a file that specifies which targets should be used to build the sources contained in this package.
</li></ol>
<p></p>
<table>

<tr valign="top">
<td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>package.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="kw1">package</span> examples.runtime.system <span class="br0">&#123;</span> 
    <span class="kw1">module</span> SysBuf; 
<span class="br0">&#125;</span></pre></td></tr></table>
</td><td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>package.bld</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw1">var</span> i = <span class="nu0">0</span>; i &lt; Build.targets.length; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">var</span> targ = Build.targets<span class="br0">&#91;</span>i<span class="br0">&#93;</span>;
&nbsp;
    <span class="kw1">var</span> lib = Pkg.addLibrary<span class="br0">&#40;</span><span class="st0">&quot;lib/&quot;</span> + Pkg.name, targ<span class="br0">&#41;</span>;
    lib.addObjects<span class="br0">&#40;</span><span class="br0">&#91;</span><span class="st0">&quot;SysBuf.c&quot;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
</td></tr></table>
<p>The <tt>package.xdc</tt> file is largely self explanatory; it defines the name of the package, <tt>examples.runtime.system</tt>, and it specifies the modules contained in the package, <tt>SysBuf</tt>.
</p><p>The <tt>package.bld</tt> file, on the other hand, requires some explanation.  This <tt>package.bld</tt> file specifies that the package contains a library in the <tt>lib/</tt> sub-directory containing the compiled version of <tt>SysBuf.c</tt> for every <a href="../Glossary/Glossary.html#Target" title="Glossary">target</a> supported by the producer's build environment.  Remarkably, this <tt>package.bld</tt> file is sufficient to compile <tt>SysBuf.c</tt> for every target, archive it into a library, and a <a href="../Glossary/Glossary.html#Release" title="Glossary">binary release</a> of this package that supports <i>all</i> targets supported by the producer's build environment.
</p>
<table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/yellow_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=Extending xdc.runtime System/Example 1&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="Extending_xdc.runtime_System.html#TOC" title="Extending xdc.runtime System"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a></td></tr></table><div id=copyInfo>Copyright &#169; 2008 The Eclipse Foundation. All Rights Reserved</div>
<!-- 
Pre-expand include size: 1495 bytes
Post-expand include size: 1097 bytes
Template argument size: 126 bytes
Maximum: 2097152 bytes
-->

			<div class="printfooter">
Retrieved from "<a href="http://rtsc.eclipse.org/docs-tip/Special:Offline">http://rtsc.eclipse.org/docs-tip/Special:Offline</a>"</div>
						<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
					 <li id="ca-nstab-special" class="selected"><a href="../Special:Offline/Special:Offline__Extending_xdc.runtime_System.html" title="This is a special page, you can't edit the page itself">Special</a></li>
				</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="mediawiki-tip/index.php?title=Special:Userlogin&amp;returnto=Special:Offline" title="You are encouraged to log in, it is not mandatory however. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(../common/extensions/rtsc/images/logo.png);" href="/docs-tip/Main_Page" title="Visit the Main Page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-RTSC-pedia-home"><a href="../Main_Page/Main_Page.html">RTSC-pedia home</a></li>
				<li id="n-RTSC-project-home"><a href="http://rtsc.eclipse.org ">RTSC project home</a></li>
				<li id="n-News-.26-support"><a href="http://www.eclipse.org/newsportal/thread.php?group=eclipse.dsdp.rtsc">News &amp; support</a></li>
				<li id="n-Help"><a href="../Help:Contents/Help:Contents.html">Help</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-binders'>
		<h5>binders</h5>
		<div class='pBody'>
			<ul>
				<li id="n-General-Information"><a href="../General_Information/General_Information.html">General Information</a></li>
				<li id="n-RTSC-Programming"><a href="../RTSC_Programming/RTSC_Programming.html">RTSC Programming</a></li>
				<li id="n-User.27s-Guide"><a href="../XDCtools_User%27s_Guide/XDCtools_User%27s_Guide.html">User's Guide</a></li>
				<li id="n-Reference-Manual"><a href="../XDCtools_Reference_Manual/XDCtools_Reference_Manual.html">Reference Manual</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-package_reference'>
		<h5>package reference</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XDCtools-packages"><a href="http://rtsc.eclipse.org/cdoc-tip/index.html ">XDCtools packages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-lists'>
		<h5>lists</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Master-doc-map"><a href="../Special:DocMap/Special:DocMap__Main_Page.html">Master doc-map</a></li>
				<li id="n-Category-query"><a href="../Special:Cats/Special:Cats.html">Category query</a></li>
				<li id="n-Redirected-pages"><a href="../Special:Listredirects/Special:Listredirects.html">Redirected pages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-tools'>
		<h5>tools</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Find.2BReplace-.28grep.29"><a href="../Special:Grep/Special:Grep.html">Find+Replace (grep)</a></li>
				<li id="n-RSS-feed"><a href="http://rtsc.eclipse.orgmediawiki-tip/index.php?title=Special:Recentchanges&amp;feed=rss ">RSS feed</a></li>
			</ul>
		</div>
	</div>
		<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/docs-tip/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" type="text" title="Search RTSC-Pedia [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>more tools</h5>
		<div class="pBody">
			<ul>
<li id="t-upload"><a href="../Special:Upload/Special:Upload.html" title="Upload images or media files [u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="../Special:Specialpages/Special:Specialpages.html" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../common/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
				<li id="privacy"><a href="../RTSC-Pedia:Privacy_policy/RTSC-Pedia:Privacy_policy.html" title="RTSC-Pedia:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="../RTSC-Pedia:About/RTSC-Pedia:About.html" title="RTSC-Pedia:About">About RTSC-Pedia</a></li>
				<li id="disclaimer"><a href="../RTSC-Pedia:General_disclaimer/RTSC-Pedia:General_disclaimer.html" title="RTSC-Pedia:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
		
	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served in 0.246 secs. --></body></html>
