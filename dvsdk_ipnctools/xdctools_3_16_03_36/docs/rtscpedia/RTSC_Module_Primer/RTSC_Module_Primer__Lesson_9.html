<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
				<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="mediawiki-tip/opensearch_desc.php" title="RTSC-Pedia (English)" />
		<title>RTSC Module Primer/Lesson 9 - Offline Version</title>
		<style type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "../common/skins/common/shared.css";
			@import "../common/skins/monobook/main.css";
		/*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="../common/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "../common/skins/monobook/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "../common/skins/monobook/IE70Fixes.css";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="../common/skins/common/IEFixes.js?97"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		
		<script type= "text/javascript">/*<![CDATA[*/
var skin = "monobook";
var stylepath = "../common/skins";
var wgArticlePath = "/docs-tip/$1";
var wgScriptPath = "mediawiki-tip";
var wgScript = "mediawiki-tip/index.php";
var wgServer = "http://rtsc.eclipse.org";
var wgCanonicalNamespace = "Special";
var wgCanonicalSpecialPageName = "Offline";
var wgNamespaceNumber = -1;
var wgPageName = "Special:Offline";
var wgTitle = "Offline";
var wgAction = "view";
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
var wgArticleId = 0;
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = 0;
/*]]>*/</script>
                
		<script type="text/javascript" src="../common/skins/common/wikibits.js?97"><!-- wikibits js --></script>
		<script type="text/javascript" src="mediawiki-tip/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "mediawiki-tip/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
<link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/ViewStyle.css" /><link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/MainStyle.css" />
	</head>
<body  class="mediawiki ns--1 ltr page-Special_Offline">
	<div id="globalWrapper" align="center">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading"></h1>
		<div id="bodyContent">
			<h3 id="siteSub">From RTSC-Pedia</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content --><div id="revInfo">revision tip</div><span id="printInfo">&#151;&#151;&nbsp;LANDSCAPE orientation</span><table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/green_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=RTSC Module Primer/Lesson 9&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="RTSC_Module_Primer__Lesson_8.html" title="Lesson 8"><img src="../common/extensions/rtsc/images/Arrow_left.png" /></a>&nbsp;<a href="RTSC_Module_Primer.html#TOC" title="RTSC Module Primer"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a>&nbsp;<a href="RTSC_Module_Primer__Lesson_10.html" title="Lesson 10"><img src="../common/extensions/rtsc/images/Arrow_right.png" /></a></td></tr></table><p id="title">RTSC Module Primer/Lesson 9</p><p id="subtitle">Modules, packages, and testing &#151; bringing it all together</p>
<p><br />
The example presented in this lesson&#151;considerably richer than any we've seen so far&#151;once again reinforces material covered earlier while simultaneously introducing some more programming idioms.  After first examining a new module that illustrates further dimensions of the instance object life-cycle, we'll then touch upon the all-important topic of module testing.  Here, we'll explore a simple organizational pattern involving a <i>pair</i> of RTSC packages&#151;one containing modules, another containing test programs&#151;which the <tt>xdc</tt> command can nevertheless manage as an integrated set.
</p><p>Being our last programming example, we've tried to forge a "grand finale" that not only brings together many of the principal themes established in earlier lessons but also exposes a few advanced aspects of RTSC demanding deeper investigation on your part moving forward.  Our next (and final) lesson will direct you towards other documentation resources found in the <b>RTSC-Pedia</b> that build upon everything you've already learned about programming in RTSC.
</p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Specifying_the_module"><span class="tocnumber">1</span> <span class="toctext">Specifying the module</span></a></li>
<li class="toclevel-1"><a href="#Implementing_the_module_.28target-domain.29"><span class="tocnumber">2</span> <span class="toctext">Implementing the module (target-domain)</span></a></li>
<li class="toclevel-1"><a href="#Implementing_the_module_.28meta-domain.29"><span class="tocnumber">3</span> <span class="toctext">Implementing the module (meta-domain)</span></a></li>
<li class="toclevel-1"><a href="#Testing_the_module"><span class="tocnumber">4</span> <span class="toctext">Testing the module</span></a></li>
<li class="toclevel-1"><a href="#Managing_a_test-suite"><span class="tocnumber">5</span> <span class="toctext">Managing a test-suite</span></a></li>
<li class="toclevel-1"><a href="#See_also"><span class="tocnumber">6</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Specifying_the_module"></a><h2> <span class="mw-headline">Specifying the module</span></h2>
<p>The module <tt>acme.filters.Fir</tt> manages instance objects representing finite-impulse-response filters, each parameterized with their own set of coefficients and each maintaining their own internal history.  After creating a filter instance, client applications would use the per-instance function <tt>apply</tt> to transform a frame of input data into a corresponding frame of output&#151;as you'll see later on in one of the module's test programs.  Now, however, we'll focus on the <tt>Fir</tt> module from the perspective of its supplier and highlight some extensions to the general programming idioms for instance modules first introduced in <a href="RTSC_Module_Primer__Lesson_8.html" title="RTSC Module Primer/Lesson 8">Lesson 8</a>.  
</p>
<table>

<tr>
<td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/package.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="xdoc">/*! Collection of DSP filter modules */</span>    
<span class="kw1">package</span> acme.filters <span class="br0">&#123;</span>    
    <span class="kw1">module</span> Fir;	
<span class="br0">&#125;</span>;</pre></td></tr></table>
</td></tr>
<tr>
<td>&nbsp;
</td></tr>
<tr>
<td><div id="cl-1:1"></div><div id="cl-1:2"></div><div id="cl-1:3"></div><div id="cl-1:4"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/Fir.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br /><span class="codexLab">1</span><br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="xdoc">/*! Simple Finite Impulse Response (FIR) filter */</span>
<span class="re1">@InstanceInitError</span>
<span class="re1">@InstanceFinalize</span>
<span class="kw1">module</span> Fir <span class="br0">&#123;</span>
&nbsp;
<span class="kw1">instance</span>:
&nbsp;
    <span class="xdoc">/*! Number of data-values per frame */</span>
    <span class="kw1">config</span> <span class="kw2">Int</span> frameLen = <span class="nu0">64</span>;
&nbsp;
    <span class="xdoc">/*! Create a new filter
     *
     *  @param(coeffs)      filter coefficients
     *  @param(coeffsLen)   number of coefficients
     */</span>
    <span class="kw2">create</span><span class="br0">&#40;</span><span class="kw2">Int16</span> coeffs<span class="br0">&#91;</span><span class="br0">&#93;</span>, <span class="kw2">Int</span> coeffsLen<span class="br0">&#41;</span>;
&nbsp;
    <span class="xdoc">/*! Apply this filter and update its internal history
     *  @param(inFrame)    readonly frame of input data
     *  @param(outFrame)   next frame of output data
     */</span>
    <span class="kw2">Void</span> apply<span class="br0">&#40;</span><span class="kw2">Int16</span> inFrame<span class="br0">&#91;</span><span class="br0">&#93;</span>, <span class="kw2">Int16</span> outFrame<span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">internal</span>:
&nbsp;
    <span class="kw1">struct</span> Instance_State <span class="br0">&#123;</span>
        <span class="kw2">Int16</span> coeffs<span class="br0">&#91;</span><span class="br0">&#93;</span>;         <span class="coMULTI">/* create argument */</span>
        <span class="kw2">Int</span> coeffsLen;          <span class="coMULTI">/* create argument */</span>
        <span class="kw2">Int</span> frameLen;           <span class="coMULTI">/* instance config */</span>
        <span class="kw2">Int16</span> history<span class="br0">&#91;</span><span class="br0">&#93;</span>;        <span class="coMULTI">/* filter history */</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></table>
</td></tr></table>
<p>As hinted in the last lesson, the declaration of <span class="kw2"><tt>create</tt></span> at line <a class="codexLink" href="#cl-1:3"><span class="codexLink">3</span></a> of <tt>Fir.xdc</tt> includes additional arguments&#151;here, an array of coefficients used internally by the per-instance function <tt>apply</tt> when filtering a frame of input data.  Unlike per-instance configs&#151;which each have a "reasonable" default value that clients can elect <i>not</i> to overwrite&#151;callers of a corresponding <tt><i>Mod</i>_create</tt> function declared with additional arguments <i>must</i> pass a corresponding set of values.
</p>
<div class="Info"><p class="Info">As a design guideline for module suppliers, you should prefer per-instance configs (with suitable defaults, of course) over required arguments to <tt><i>Mod</i>_create</tt> whenever possible.  As your module evolves over time, adding new per-instance configs (with defaults) would <i>not</i> require existing clients to change their source code; for technical reasons beyond the scope of this Primer, your clients wouldn't even need to re-compile their sources against your module's newly-generated header declaring its newly-expanded <tt><i>Mod</i>_Params</tt> structure.  You would not, however, have the same flexibility to change the overall signature of <tt><i>Mod</i>_create</tt> over time without explicitly breaking source-level compatibility in your existing client code-base.</p></div>
<p>Anticipating the target-implementation of <tt>Fir</tt> (coming momentarily), the <tt>Instance_State</tt> declaration beginning at line <a class="codexLink" href="#cl-1:4"><span class="codexLink">4</span></a> of <tt>Fir.xdc</tt> includes a <tt>history</tt> array whose length is a function of <tt>coeffsLen</tt> and <tt>frameLen</tt>.  This suggests that instances objects created dynamically through client calls to <tt>Fir_create</tt> or <tt>Fir_construct</tt> would <i>internally</i> lead to further dynamic allocation of this <tt>history</tt> array from some suitable memory heap.  Details aside for a moment, the new <a href="../XDCspec_-_%40InstanceInitError/XDCspec_-_%40InstanceInitError.html" title="XDCspec - @InstanceInitError"><span class="re1"><tt>@InstanceInitError</tt></span></a> attribute back at line <a class="codexLink" href="#cl-1:1"><span class="codexLink">1</span></a> declares that intializing per-instance state inside <tt>Fir</tt> can potentially raise an error (say, if memory were unavailable).  Similarly, the <a href="../XDCspec_-_%40InstanceFinalize/XDCspec_-_%40InstanceFinalize.html" title="XDCspec - @InstanceFinalize"><span class="re1"><tt>@InstanceFinalize</tt></span></a> attribute at line <a class="codexLink" href="#cl-1:2"><span class="codexLink">2</span></a> declares that the <tt>Fir</tt> target-implementation will explicitly intercept client calls to <tt>Fir_delete</tt> or <tt>Fir_destruct</tt>&#151;presumably to free the previously-allocated <tt>history</tt> array associated with the current instance object.
</p>
<div class="Info"><p class="Info">Though independent from one another in theory, this pair of <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> attributes often appear together in practice:  internal resource acquisition performed during instance creation can, in general, fail (<span class="re1"><tt>@InstanceInitError</tt></span>); and resources successfully acquired upon instance creation must subsequently be relinquished during instance deletion (<span class="re1"><tt>@InstanceFinalize</tt></span>).</p></div>
<a name="Implementing_the_module_.28target-domain.29"></a><h2> <span class="mw-headline">Implementing the module (target-domain)</span></h2>
<p>Turning now to <tt>Fir.c</tt>, pay particular attention to the expanded signature of <tt>Fir_Instance_init</tt>&#151;which generalizes the <tt><i>Mod</i>_Instance_init</tt> pattern first seen in the context of <tt>RandGen</tt> back in <a href="RTSC_Module_Primer__Lesson_8.html#Implementing_the_module_.28target-domain.29" title="RTSC Module Primer/Lesson 8">Lesson 8</a>.  You should also take note of <tt>Fir_Instance_finalize</tt>&#151;another special function supporting one particular aspect of the instance object life-cycle. 
</p>
<div id="cl-2:1"></div><div id="cl-2:2"></div><div id="cl-2:3"></div><div id="cl-2:4"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/Fir.c</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="c"><span class="re1">#include</span> <span class="re2">&lt;xdc/runtime/Error.h&gt;</span>
<span class="re1">#include</span> <span class="re2">&lt;xdc/runtime/Memory.h&gt;</span>
<span class="re1">#include</span> <span class="st0">&quot;package/internal/Fir.xdc.h&quot;</span>
&nbsp;
<span class="re1">#include</span> &lt;string.h&gt;
&nbsp;
<span class="kw1">static</span> <span class="kw2">SizeT</span> historySize<span class="br0">&#40;</span>Fir_Object *obj<span class="br0">&#41;</span>    <span class="coMULTI">/* helper function */</span>
<span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="br0">&#40;</span>obj-&gt;coeffsLen + obj-&gt;frameLen - <span class="nu0">1</span><span class="br0">&#41;</span> * <span class="kw1">sizeof</span> <span class="br0">&#40;</span><span class="kw2">Int16</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">Int</span> Fir_Instance_init<span class="br0">&#40;</span>Fir_Object *obj, <span class="kw2">Int16</span> coeffs<span class="br0">&#91;</span><span class="br0">&#93;</span>, <span class="kw2">Int</span> coeffsLen,
                      const Fir_Params *params, Error_Block* eb<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    obj-&gt;coeffs = coeffs;
    obj-&gt;coeffsLen = coeffsLen;
    obj-&gt;frameLen = params-&gt;frameLen;
&nbsp;
    obj-&gt;history = Memory_calloc<span class="br0">&#40;</span><span class="kw2">NULL</span>, historySize<span class="br0">&#40;</span>obj<span class="br0">&#41;</span>, <span class="nu0">4</span>, eb<span class="br0">&#41;</span>;
    <span class="kw1">return</span> <span class="nu0">0</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">Void</span> Fir_Instance_finalize<span class="br0">&#40;</span>Fir_Object *obj, <span class="kw2">Int</span> status<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    Memory_free<span class="br0">&#40;</span><span class="kw2">NULL</span>, obj-&gt;history, historySize<span class="br0">&#40;</span>obj<span class="br0">&#41;</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">Void</span> Fir_apply<span class="br0">&#40;</span>Fir_Object *obj, <span class="kw2">Int16</span> inFrame<span class="br0">&#91;</span><span class="br0">&#93;</span>, <span class="kw2">Int16</span> outFrame<span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw2">Int</span> i, j;
    Int32 sum;
&nbsp;
    <span class="kw2">Int</span> coeffsLen = obj-&gt;coeffsLen;
    <span class="kw2">Int</span> frameLen = obj-&gt;frameLen;
&nbsp;
    <span class="kw2">Int16</span> *history = obj-&gt;history;
    <span class="kw2">Int16</span> *coeffs = obj-&gt;coeffs;
&nbsp;
    memcpy<span class="br0">&#40;</span>&amp;history<span class="br0">&#91;</span>coeffsLen - <span class="nu0">1</span><span class="br0">&#93;</span>, inFrame, frameLen * <span class="kw1">sizeof</span> <span class="br0">&#40;</span><span class="kw2">Int16</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
&nbsp;
    <span class="kw1">for</span> <span class="br0">&#40;</span>j = <span class="nu0">0</span>; j &lt; frameLen; j++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        sum = <span class="nu0">0</span>;
        <span class="kw1">for</span> <span class="br0">&#40;</span>i = <span class="nu0">0</span>; i &lt; coeffsLen; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            sum += history<span class="br0">&#91;</span>i + j<span class="br0">&#93;</span> * coeffs<span class="br0">&#91;</span>i<span class="br0">&#93;</span>;
        <span class="br0">&#125;</span>
&nbsp;
        *outFrame++ = <span class="br0">&#40;</span><span class="kw2">Int16</span><span class="br0">&#41;</span><span class="br0">&#40;</span>sum &gt;&gt; <span class="nu0">15</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
&nbsp;
    memcpy<span class="br0">&#40;</span>history, &amp;history<span class="br0">&#91;</span>frameLen<span class="br0">&#93;</span>, <span class="br0">&#40;</span>coeffsLen - <span class="nu0">1</span><span class="br0">&#41;</span> * <span class="kw1">sizeof</span> <span class="br0">&#40;</span><span class="kw2">Int16</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;    
<span class="br0">&#125;</span></pre></td></tr></table>
<div class="Info"><p class="Info">If you've had any prior experience with FIR filters, our "textbook" implementation of <tt>Fir_apply</tt> beginning at line <a class="codexLink" href="#cl-2:4"><span class="codexLink">4</span></a> should seem straightforward.  But if you don't have a clue what's happening inside this function, don't worry about it&#151;nothing more will be said about <tt>Fir_apply</tt>.  Rather, our focus here remains on the instance object life-cycle in general and the functions <tt>Fir_Instance_init</tt> and <tt>Fir_Instance_finalize</tt> in particular.</p></div>
<p>Turning first to the definition of <tt>Fir_Instance_init</tt> beginning at line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a>, its expanded signature results from two separate declarations found in the module's spec file:
</p>
<ul><li> the <span class="kw2"><tt>create</tt></span> declaration at line <a class="codexLink" href="#cl-1:3"><span class="codexLink">3</span></a> of <tt>Fir.xdc</tt> contributed the additional <tt>coeffs</tt> and <tt>coeffsLen</tt> arguments, which are subsequently retained in the instance object; and
</li></ul>
<p></p>
<ul><li> the <span class="re1"><tt>@InstanceInitError</tt></span> declaration at line <a class="codexLink" href="#cl-1:1"><span class="codexLink">1</span></a> of <tt>Fir.xdc</tt> contributed the additional <tt>eb</tt> argument, which is subsequently used to handle memory allocation errors.
</li></ul>
<p>As already hinted, <tt>Fir_Instance_init</tt> internally calls upon <tt>Memory_calloc</tt> to allocate and zero-fill a block of memory large enough to hold the <tt>history</tt> array associated with this instance object.  Generalizing the familiar <tt>calloc</tt> function of standard C, the extra arguments to <tt>Memory_calloc</tt> give the caller additional degrees of control:
</p>
<ul><li> arg #1 designates the heap to use for the allocation, with <tt>NULL</tt> implying a system-wide default;
</li><li> arg #2 designates the number of bytes to allocate, here returned by <tt>historySize</tt> defined at line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a>;
</li><li> arg #3 designates the addressing alignment for the allocation, represented by a power-of-two; and
</li><li> arg #4 passes an <tt>Error_Block*</tt> used to raise/handle errors, with <tt>NULL</tt> triggering a default strategy.
</li></ul>
<p>The last argument passed to <tt>Memory_calloc</tt> of course tracks the <tt>eb</tt> argument passed to <tt>Fir_Instance_init</tt>; and this <tt>eb</tt> argument in turn reflects the last argument passed by the client to <tt>Fir_create</tt> or <tt>Fir_construct</tt>&#151;which also happens to be of type <tt>Error_Block*</tt>.  Once again, passing <tt>NULL</tt> as this final argument would trigger a default error strategy&#151;typically, print an appropriate message and then abort execution whenever the program raises an error.  In the case of the <tt>Fir_Instance_init</tt> function defined back at line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a>, a <tt>NULL</tt> value for <tt>eb</tt> here implies that control would <i>not</i> return from <tt>Memory_calloc</tt> should the latter function raise an out-of-memory error.
</p>
<div class="Info"><p class="Info">Our next and final lesson will direct you to documentation specifically illustrating each facet of the <tt>xdc.runtime.Error</tt> module.  Offering a step-up from the age-old practice in C of simply returning "status-codes"&#151;which clients ignore anyway&#151;the <tt>Error</tt> module drives some discipline and structure in the raising/handling of runtime errors,  more aligned with modern software practices (think Java exceptions) but <i>without</i> the runtime overhead normally associated with these mechanisms (think C++ exceptions).</p></div>
<p>Besides contributing its <tt>eb</tt> argument, the original <span class="re1"><tt>@InstanceInitError</tt></span> declaration back at line <a class="codexLink" href="#cl-1:1"><span class="codexLink">1</span></a> of <tt>Fir.xdc</tt> also changed the return type of the <tt>Fir_Instance_init</tt> function from <span class="kw2"><tt>Void</tt></span> to <span class="kw2"><tt>Int</tt></span>.  In general, the value returned from this form of the <a href="../C_-_Instance_init/C_-_Instance_init.html" title="C - Instance init"><tt><i>Mod</i>_Instance_init</tt></a> function serves as a completion status which, if non-zero, signifies some sort of failure has occurred while initializing the current instance object and that the function has abruptly returned.  In the latter case, RTSC effectively reverses the effects of the outstanding call to <tt>create</tt> or <tt>construct</tt> by performing the internal equivalent of a <tt>delete</tt> or <tt>destruct</tt> call on the current instance object.
</p><p>The <tt>Fir_Instance_finalize</tt> function defined at line <a class="codexLink" href="#cl-2:3"><span class="codexLink">3</span></a> of <tt>Fir.c</tt> effectively complements <tt>Fir_Instance_init</tt>, relinquishing any resources successfully acquired in the latter function.  Automatically invoked in response to client calls to <tt>Fir_delete</tt> or <tt>Fir_destruct</tt>, the <tt>Instance_finalize</tt> function here calls <tt>Memory_free</tt> within arguments similar to those passed earlier to <tt>Memory_calloc</tt> after line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a>.  Note that since <tt>Fir_Instance_init</tt> returns a completion status (due to <span class="re1"><tt>@InstanceInitError</tt></span>), RTSC automatically forwards this value to <tt>Fir_Instance_finalize</tt> if non-zero.  Client-initiated calls to <tt>Fir_delete</tt> or <tt>Fir_destruct</tt>&#151;implying an earlier corresponding call to <tt>Fir_create</tt> or <tt>Fir_construct</tt> had succeeded&#151;pass <tt>0</tt> as the <tt>status</tt> argument to <tt>Fir_Instance_finalize</tt>.     
</p>
<div class="Info"><p class="Info">Notwithstanding our earlier comment about <tt>xdc.runtime.Error</tt> and status-codes, the <tt>status</tt> value returned by <a href="../C_-_Instance_init/C_-_Instance_init.html" title="C - Instance init"><tt><i>Mod</i>_Instance_init</tt></a> and forwarded to <a href="../C_-_Instance_finalize/C_-_Instance_finalize.html" title="C - Instance finalize"><tt><i>Mod</i>_Instance_finalize</tt></a> generally enables the latter function to quickly ascertain (say, using a C <span class="kw1"><tt>switch</tt></span> statement) just how much "clean-up" processing the current instance object may require.  With functions like <tt>Memory_free</tt> and <tt><i>Mod</i>_delete</tt> already acting like idempotent no-ops when passed <tt>NULL</tt> arguments (and with <tt><i>Mod</i>_Object</tt> structures automatically zero-initialized by RTSC), module suppliers can often layout <tt><i>Mod</i>_Instance_finalize</tt> functions as "straight-line" code laced with appropriate <tt>case</tt> labels testing successively higher <tt>status</tt> values returned from <tt><i>Mod</i>_Instance_init</tt>, with the (normal) case of <tt>0</tt> executing the entire function from top to bottom.  Beside emphasizing that finalization truly reverses the effects of initialization, this technique typically yields faster and more compact implementations of <tt><i>Mod</i>_Instance_finalize</tt> functions.</p></div>
<a name="Implementing_the_module_.28meta-domain.29"></a><h2> <span class="mw-headline">Implementing the module (meta-domain)</span></h2>
<p>The new dimension of memory allocation in the target-function <tt>Fir_Instance_init</tt> results in corresponding additions to the special <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> meta-function <tt>instance$static$init</tt> defined in <tt>Fir.xs</tt>.  Here, however, the <tt>history</tt> array associated with each statically-created instance object is likewise statically-allocated.
</p>
<div id="cl-3:1"></div><div id="cl-3:2"></div><div id="cl-3:3"></div><div id="cl-3:4"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/Fir.xs</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab"><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2</span><br /><span class="codexLab">3</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4</span><br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Error, Memory, Program;
&nbsp;
<span class="kw1">function</span> module$use<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    Error = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.runtime.Error'</span><span class="br0">&#41;</span>;
    Memory = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.runtime.Memory'</span><span class="br0">&#41;</span>;
    Program = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.cfg.Program'</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> instance$static$init<span class="br0">&#40;</span>obj, coeffs, coeffsLen, params<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    obj.coeffs = coeffs;
    obj.coeffsLen = coeffsLen;
    obj.frameLen = params.frameLen;
&nbsp;
    Memory.staticPlace<span class="br0">&#40;</span>obj.history, <span class="nu0">4</span>, <span class="kw2">null</span><span class="br0">&#41;</span>;
    obj.history.length = historySize<span class="br0">&#40;</span>obj<span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> historySize<span class="br0">&#40;</span>obj<span class="br0">&#41;</span>    <span class="coMULTI">/* helper function */</span>
<span class="br0">&#123;</span>
    <span class="kw1">var</span> sz =  Program.build.target.stdTypes.t_Int16.size;
    <span class="kw1">return</span> <span class="br0">&#40;</span>obj.coeffsLen + obj.frameLen - <span class="nu0">1</span><span class="br0">&#41;</span> * sz;
<span class="br0">&#125;</span></pre></td></tr></table>
<p>Since RTSC happens to invoke the special function <tt>module$use</tt> <i>before</i> <tt>instance$static$init</tt>, we've leveraged the former function to initialize some file-level variables declared at line <a class="codexLink" href="#cl-3:1"><span class="codexLink">1</span></a>.  In the case of <tt>Memory</tt>&#151;referencing the <tt>xdc.runtime.Memory</tt> module&#151;<tt>instance$static$init</tt> invokes one of its meta-functions at line <a class="codexLink" href="#cl-3:2"><span class="codexLink">2</span></a> to statically locate the <tt>history</tt> array associated with the current instance object.  While clearly different from the target-side call to <tt>Memory_calloc</tt> back at line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a> of <tt>Fir.c</tt>, the 2nd and 3rd arguments to <tt>Memory.staticPlace</tt> analogously designate the addressing alignment and memory section (heap) used for this allocation.
</p>
<div class="Info"><p class="Info">Lesson 10 will direct you towards an appropriate User's Guide containing a series of examples that focus upon the <tt>xdc.runtime.Memory</tt> module, not only its more common usage in the target-domain but also its role in guiding the placement of statically-allocated data from within the meta-domain.</p></div> 
<p>Following an idiom rooted in JavaScript, we've dimensioned <tt>obj.history</tt> at line <a class="codexLink" href="#cl-3:3"><span class="codexLink">3</span></a> of <tt>Fir.xs</tt> by simply assigning to the special <tt>length</tt> property available on all <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> arrays.  In this case, we've used a (private) <tt>historySize</tt> meta-function defined in <tt>Fir.xs</tt> in exactly the same way as <tt>Fir_Instance_init</tt> used a (private) <tt>historySize</tt> <i>target-function</i> defined at line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> of <tt>Fir.c</tt>.   Though highly "dynamic" in the meta-domain, <tt>obj.history</tt> (like <tt>obj</tt> itself) at the end of the day becomes a <i>static</i> C variable in the target-domain.
</p>
<div class="Info"><p class="Info">The <tt>Program.build</tt> property&#151;yet another <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> object with many more properties of its own&#151;encapsulates a wealth of information about the build context of the program currently being configured.  One piece of information contained therein reflects the current program's RTSC target, whether originally named through an <tt>addExecutable</tt> call inside a <tt>package.bld</tt> script or else through a <tt>-t</tt> option to an <span class="cmdFrag"><tt>xs xdc.tools.configuro</tt></span> command inside a client <tt>makefile</tt>.  The <tt>Program.build.target</tt> object in turn has further properties that enable us to ascertain (among other things) the actual size of a standard type (here, <tt>Int16</tt>) on this particular target; use of this rather long-winded idiom at line <a class="codexLink" href="#cl-3:4"><span class="codexLink">4</span></a> of <tt>Fir.xs</tt> directly parallels the C <tt>sizeof</tt> operator appearing after line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> of <tt>Fir.c</tt>.</p></div>
<a name="Testing_the_module"></a><h2> <span class="mw-headline">Testing the module</span></h2>
<p>Suppliers of RTSC modules&#151;like all good software engineers&#151;will no doubt maintain a suite of test programs that systematically exercise all client-visible features of each module ("black-box" tests) as well as various aspects of each module's internal implementation ("white-box" tests).  Consider, for example, a black-box test of <tt>acme.filters.Fir</tt> that applies a newly-created filter to a known frame of data and outputs the results.  As a byproduct, this test program also uses the <tt>acme.utils.Bench</tt> module to measure the elapsed time of the call to <tt>Fir_apply</tt>.  
</p>
<div id="cl-4:1"></div><div id="cl-4:2"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>FirTest1.c</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="c"><span class="re1">#include</span> <span class="re2">&lt;acme/filters/Fir.h&gt;</span>
<span class="re1">#include</span> <span class="re2">&lt;acme/utils/Bench.h&gt;</span>
<span class="re1">#include</span> <span class="re2">&lt;xdc/runtime/System.h&gt;</span>
&nbsp;
<span class="re1">#define</span> COEFFSLEN <span class="nu0">4</span>
<span class="re1">#define</span> FRAMELEN <span class="nu0">20</span>
&nbsp;
<span class="kw1">static</span> <span class="kw2">Int16</span> coeffs<span class="br0">&#91;</span>COEFFSLEN<span class="br0">&#93;</span> = <span class="br0">&#123;</span><span class="nu0">20000</span>, <span class="nu0">21000</span>, <span class="nu0">22000</span>, <span class="nu0">-3000</span><span class="br0">&#125;</span>; 
&nbsp;
<span class="kw1">static</span> <span class="kw2">Int16</span> inFrame<span class="br0">&#91;</span>FRAMELEN<span class="br0">&#93;</span> = <span class="br0">&#123;</span><span class="nu0">0</span>,<span class="nu0">1</span>,<span class="nu0">2</span>,<span class="nu0">3</span>,<span class="nu0">4</span>,<span class="nu0">5</span>,<span class="nu0">6</span>,<span class="nu0">7</span>,<span class="nu0">8</span>,<span class="nu0">9</span>,<span class="nu0">0</span>,<span class="nu0">1</span>,<span class="nu0">2</span>,<span class="nu0">3</span>,<span class="nu0">4</span>,<span class="nu0">5</span>,<span class="nu0">6</span>,<span class="nu0">7</span>,<span class="nu0">8</span>,<span class="nu0">9</span><span class="br0">&#125;</span>;
<span class="kw1">static</span> <span class="kw2">Int16</span> outFrame<span class="br0">&#91;</span>FRAMELEN<span class="br0">&#93;</span>;
&nbsp;
<span class="kw1">static</span> <span class="kw2">Void</span> printOut<span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw2">Int</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    Fir_Handle fir;
    Fir_Params params;
&nbsp;
    Fir_Params_init<span class="br0">&#40;</span>&amp;params<span class="br0">&#41;</span>;
    params.frameLen = FRAMELEN;
&nbsp;
    fir = Fir_create<span class="br0">&#40;</span>coeffs, COEFFSLEN, &amp;params, <span class="kw2">NULL</span><span class="br0">&#41;</span>;  <span class="coMULTI">/* create filter */</span>
    Bench_begin<span class="br0">&#40;</span><span class="st0">&quot;<span class="es0">\t</span>--&gt; Portable Baseline&quot;</span><span class="br0">&#41;</span>;              <span class="coMULTI">/* start benchmark */</span>
    Fir_apply<span class="br0">&#40;</span>fir, inFrame, outFrame<span class="br0">&#41;</span>;                   <span class="coMULTI">/* run filter */</span>
    Bench_end<span class="br0">&#40;</span><span class="br0">&#41;</span>;                                         <span class="coMULTI">/* stop and display timing */</span>
    printOut<span class="br0">&#40;</span><span class="br0">&#41;</span>;                                          <span class="coMULTI">/* display results */</span>
    Fir_delete<span class="br0">&#40;</span>&amp;fir<span class="br0">&#41;</span>;                                    <span class="coMULTI">/* delete filter */</span>
&nbsp;
    <span class="kw1">return</span> <span class="nu0">0</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">static</span> <span class="kw2">Void</span> printOut<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw2">Int</span> i;
    <span class="kw2">String</span> comma = <span class="st0">&quot;&quot;</span>;
&nbsp;
    System_printf<span class="br0">&#40;</span><span class="st0">&quot;<span class="es0">\t</span>outFrame = {&quot;</span><span class="br0">&#41;</span>;
    <span class="kw1">for</span> <span class="br0">&#40;</span>i = <span class="nu0">0</span>; i &lt; FRAMELEN; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        System_printf<span class="br0">&#40;</span><span class="st0">&quot;%s%d&quot;</span>, comma, outFrame<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span>;
        comma = <span class="st0">&quot;,&quot;</span>;
    <span class="br0">&#125;</span>
    System_printf<span class="br0">&#40;</span><span class="st0">&quot;}<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
<p>As you would expect, the call to <tt>Fir_create</tt> at line <a class="codexLink" href="#cl-4:1"><span class="codexLink">1</span></a> above takes two additional arguments, matching the declaration back at line <a class="codexLink" href="#cl-1:3"><span class="codexLink">3</span></a> of <tt>Fir.xdc</tt>; and as we already noted, <i>all</i> of these parameters (including the <tt>NULL</tt>-valued <tt>Error_Block*</tt>) eventually arrive at <tt>Fir_Instance_init</tt> defined at line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a> of <tt>Fir.c</tt>.  Similarly, the call to <tt>Fir_delete</tt> at line <a class="codexLink" href="#cl-4:2"><span class="codexLink">2</span></a> above would internally invoke <tt>Fir_Instance_finalize</tt> defined at line <a class="codexLink" href="#cl-2:3"><span class="codexLink">3</span></a> of <tt>Fir.c</tt>.
</p><p>Turning to the corresponding meta-program for <tt>FirTest1</tt>, configuring the <tt>Bench</tt> module here takes on a new twist. 
</p>
<table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>FirTest1.cfg</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Program = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.cfg.Program'</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">var</span> Bench = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'acme.utils.Bench'</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> Fir = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'acme.filters.Fir'</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> System = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.runtime.System'</span><span class="br0">&#41;</span>;
&nbsp;
Bench.enableFlag = <span class="br0">&#40;</span>Program.build.target.isa == <span class="st0">&quot;64P&quot;</span><span class="br0">&#41;</span>;</pre></td></tr></table>
<p>Once again, we've leveraged the wealth of information attached to the special <tt>xdc.cfg.Program</tt> module&#151;here, to conditionally assign <tt>Bench.enableFlag</tt> based on the current program's target.  Though somewhat contrived since <tt>Bench</tt> <i>does</i> work on all targets (though perhaps with less-than-useful accuracy on some), this fragment nevertheless illustrates a RTSC meta-programming technique that often eliminates the need for an <span class="re1"><tt>#ifdef</tt></span> <tt>__64plus__</tt> preprocessor directives in the corresponding target-program.
</p>
<div class="Info"><p class="Info">Not that C <span class="re1"><tt>#ifdef</tt></span> directives are necessarily bad (though they often lead to ever-compounding clutter within never-quite-finished source files), you can largely avoid using <span class="re1"><tt>#ifdef</tt></span>'s altogether through the potent combination of meta-domain configuration, whole-program optimization, plus some design-patterns involving RTSC <b>interfaces</b>&#151;the central focus of a companion Primer we'll have more to say about in the next lesson.  Wherever and whenever possible, RTSC promotes a "write-once" approach to module implementation (especially in the target-domain) where a single C source file&#151;one that's clean, readable, robust, and ultimately <i>finished</i>&#151;can be effectively re-used across a wide range of targets, platforms, and applications without constant modification.</p></div>
<a name="Managing_a_test-suite"></a><h2> <span class="mw-headline">Managing a test-suite</span></h2>
<p>Though we've only presented a single test program here, you could well imagine a package with multiple modules that in turn each implement multiple functions having <i>multiple</i> test programs&#151;dozens, if not hundreds; and the problem only compounds itself when a single supplier offers multiple packages (<tt>acme.filters</tt>, <tt>acme.utils</tt>, and so on).
</p><p>As in last few lessons, the <tt>package.bld</tt> script for a package like <tt>acme.filters</tt> will <i>only</i> build target libraries containing compiled implementations for each module in the package&#151;but <i>no</i> executable programs.
</p>
<table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/package.bld</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Build = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.BuildEnvironment'</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> Pkg = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.PackageContents'</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">var</span> LIB_NAME = <span class="st0">&quot;lib/&quot;</span> + Pkg.name;
<span class="kw1">var</span> LIB_SRCS = <span class="br0">&#91;</span><span class="st0">&quot;Fir.c&quot;</span><span class="br0">&#93;</span>;
&nbsp;
<span class="kw1">for</span> <span class="kw1">each</span> <span class="br0">&#40;</span><span class="kw1">var</span> targ <span class="kw1">in</span> Build.targets<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Pkg.addLibrary<span class="br0">&#40;</span>LIB_NAME, targ<span class="br0">&#41;</span>.addObjects<span class="br0">&#40;</span>LIB_SRCS<span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
<p>Instead, all executable test programs pertaining to the <tt>acme.filters</tt> package will themselves reside in <i>another</i> package named (by convention) <tt>acme.filters.test</tt> that otherwise contains no modules.  The <tt>package.xdc</tt> spec file for this new package in turn explicitly <span class="kw1"><tt>requires</tt></span> (using a new <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> keyword) the presence of other RTSC packages upon which the content of <tt>acme.filters.test</tt> in someway depends&#151;including, but not limited to, our original <tt>acme.filters</tt> package.
</p>
<div id="cl-5:1"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/test/package.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab"><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="kw1">requires</span> acme.filters;
<span class="kw1">requires</span> acme.utils;
&nbsp;
<span class="xdoc">/*! Companion tests for acme.filters */</span>    
<span class="kw1">package</span> acme.filters.test <span class="br0">&#123;</span>    
    <span class="coMULTI">/* no modules */</span>	
<span class="br0">&#125;</span>;</pre></td></tr></table>
<p>Turning now to the <tt>package.bld</tt> script for our <tt>acme.filters.test</tt> package&#151;which easily scales when managing more than one test&#151;the script features a doubly-nested <span class="kw1"><tt>for</tt> <tt>each</tt></span> loop used to not only iteratively build the same test program for multiple targets but to iterate over a set of tests as well.
</p>
<table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>acme/filters/test/package.bld</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Build = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.BuildEnvironment'</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> Pkg = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.PackageContents'</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">var</span> TEST_NAMES = <span class="br0">&#91;</span><span class="st0">&quot;FirTest1&quot;</span><span class="br0">&#93;</span>;
&nbsp;
<span class="kw1">for</span> <span class="kw1">each</span> <span class="br0">&#40;</span><span class="kw1">var</span> targ <span class="kw1">in</span> Build.targets<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">for</span> <span class="kw1">each</span> <span class="br0">&#40;</span><span class="kw1">var</span> testName <span class="kw1">in</span> TEST_NAMES<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Pkg.addExecutable<span class="br0">&#40;</span>testName, targ, targ.platform<span class="br0">&#41;</span>.addObjects<span class="br0">&#40;</span><span class="br0">&#91;</span>testName + <span class="st0">&quot;.c&quot;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></table>
<div class="Info"><p class="Info">We've said it before, and we'll say it again&#151;<tt>package.bld</tt> <i>is</i> a program.  And like any program written in any programming language, <span class="kw1"><tt>for</tt></span> loops enable us to aggregate a "closed" set of processing statements that otherwise can operate across an "open-ended" set of data values&#151;in this case, the names of the individual tests in our test-suite.  Taking this one step further, the names of the tests themselves often exhibit a pattern-like regularity&#151;such as <tt><i>Mod</i>Test<i>i</i></tt>&#151;that itself suggests further opportunities for nested <span class="kw1"><tt>for</tt></span> loops; and complex mappings that share a common meta-program <tt>.cfg</tt> file across a set of related target-program <tt>.c</tt> files might be captured in a corresponding <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> data object likewise processed through some generic iterators.  Whatever the case may be, you can "shape" the <tt>package.bld</tt> script to best reflect the inherent structure of the problem at hand.</p></div>
<p>In practice, development of modules inside a package like <tt>acme.filters</tt> and development of test programs for these modules inside a package like <tt>acme.filters.test</tt> will proceed in parallel.  To streamline the repetitive re-builds of either package as well as to ensure both packages remain in sync with one another before executing any tests, we'll rely upon an extended form of the <tt>xdc</tt> command that operates on a <i>set</i> of packages designated using the <tt>-P</tt> option and its variants.
</p>
<table style="margin-left:5.5em; border:1px solid #ddd; font-size:90%" cellpadding="3" cellspacing="0">

<tr>
<td style="width:20em;"><tt>xdc [<i>goal</i> ...] -P &nbsp;<i>pkg-dir</i> ...</tt>
</td><td>build goal(s) in each package directory
</td></tr>
<tr style="background:#e8e8e8;">
<td><tt>xdc [<i>goal</i> ...] -PR <i>dir</i> ...</tt>
</td><td>build goal(s) in all packages found by recursively searching each directory
</td></tr>
<tr>
<td><tt>xdc [<i>goal</i> ...] -PD <i>pkg-dir</i> ...</tt>
</td><td>build goal(s) in each package directory along with all dependent packages
</td></tr></table>
<p>For example, you could invoke a single <span class="cmdFrag"><tt>xdc</tt> <tt>test</tt> <tt>-PR</tt> <tt>.</tt></span> command from within the <tt><span class="mq">&laquo;</span>examples<span class="mq">&raquo;</span>/acme/filters</tt> directory to systematically build both packages before executing all test programs.  Or, if you prefer, sitting inside the <tt><span class="mq">&laquo;</span>examples<span class="mq">&raquo;</span>/acme/filters/tests</tt> package you can achieve the same results by invoking <span class="cmdFrag"><tt>xdc</tt> <tt>test</tt> <tt>-PD</tt> <tt>.</tt></span> which automatically recognizes <tt>acme.filters</tt> as a dependent package (per line <a class="codexLink" href="#cl-5:1"><span class="codexLink">1</span></a> of its <tt>package.xdc</tt> spec).  In the latter case, the <tt>-PD</tt> option will <i>also</i> re-build the dependent <tt>acme.utils</tt> package&#151;just in case you happened to make a change to (say) the <tt>Bench</tt> module. 
</p>
<div class="Info"><p class="Info">All we can say about this incredibly powerful generalization of the already-potent <tt>xdc</tt> command is:&nbsp;  <i>try it, you'll like it!</i></p></div>
<a name="See_also"></a><h2> <span class="mw-headline">See also</span></h2>
<p></p>
<table id="TOC" class="DocList">

<tr>
<td class="DocListTitle1" style="width:35%;"><a href="../Command_-_xdc/Command_-_xdc.html" title="Command - xdc">Command - xdc</a>
</td><td class="DocListSubTitle1">eXpanDed C package build command
</td></tr>
<tr>
<td class="DocListTitle" style="width:35%;"><a href="../XDCspec_-_%40InstanceInitError/XDCspec_-_%40InstanceInitError.html" title="XDCspec - @InstanceInitError">XDCspec - @InstanceInitError</a>
</td><td class="DocListSubTitle">This module's instance initialization can fail
</td></tr>
<tr>
<td class="DocListTitle" style="width:35%;"><a href="../XDCspec_-_%40InstanceFinalize/XDCspec_-_%40InstanceFinalize.html" title="XDCspec - @InstanceFinalize">XDCspec - @InstanceFinalize</a>
</td><td class="DocListSubTitle">This module's instances require finalization
</td></tr>
<tr>
<td class="DocListSpacer">&nbsp;
</td></tr>
<tr>
<td class="DocListTitle" style="width:35%;"><a href="../../cdoc/xdc/runtime/Error.html#.Block" class="cdoc"><tt>xdc.runtime.Error.Block</tt></a>
</td><td class="DocListSubTitle">Client documentation for <tt>xdc.runtime.Error.Block</tt>
</td></tr></table>
<p></p>
<table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/green_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=RTSC Module Primer/Lesson 9&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="RTSC_Module_Primer__Lesson_8.html" title="Lesson 8"><img src="../common/extensions/rtsc/images/Arrow_left.png" /></a>&nbsp;<a href="RTSC_Module_Primer.html#TOC" title="RTSC Module Primer"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a>&nbsp;<a href="RTSC_Module_Primer__Lesson_10.html" title="Lesson 10"><img src="../common/extensions/rtsc/images/Arrow_right.png" /></a></td></tr></table><div id=copyInfo>Copyright &#169; 2008 The Eclipse Foundation. All Rights Reserved</div>
<!-- 
Pre-expand include size: 16448 bytes
Post-expand include size: 4466 bytes
Template argument size: 610 bytes
Maximum: 2097152 bytes
-->

			<div class="printfooter">
Retrieved from "<a href="http://rtsc.eclipse.org/docs-tip/Special:Offline">http://rtsc.eclipse.org/docs-tip/Special:Offline</a>"</div>
						<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
					 <li id="ca-nstab-special" class="selected"><a href="../Special:Offline/Special:Offline__RTSC_Module_Primer.html" title="This is a special page, you can't edit the page itself">Special</a></li>
				</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="mediawiki-tip/index.php?title=Special:Userlogin&amp;returnto=Special:Offline" title="You are encouraged to log in, it is not mandatory however. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(../common/extensions/rtsc/images/logo.png);" href="/docs-tip/Main_Page" title="Visit the Main Page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-RTSC-pedia-home"><a href="../Main_Page/Main_Page.html">RTSC-pedia home</a></li>
				<li id="n-RTSC-project-home"><a href="http://rtsc.eclipse.org ">RTSC project home</a></li>
				<li id="n-News-.26-support"><a href="http://www.eclipse.org/newsportal/thread.php?group=eclipse.dsdp.rtsc">News &amp; support</a></li>
				<li id="n-Help"><a href="../Help:Contents/Help:Contents.html">Help</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-binders'>
		<h5>binders</h5>
		<div class='pBody'>
			<ul>
				<li id="n-General-Information"><a href="../General_Information/General_Information.html">General Information</a></li>
				<li id="n-RTSC-Programming"><a href="../RTSC_Programming/RTSC_Programming.html">RTSC Programming</a></li>
				<li id="n-User.27s-Guide"><a href="../XDCtools_User%27s_Guide/XDCtools_User%27s_Guide.html">User's Guide</a></li>
				<li id="n-Reference-Manual"><a href="../XDCtools_Reference_Manual/XDCtools_Reference_Manual.html">Reference Manual</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-package_reference'>
		<h5>package reference</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XDCtools-packages"><a href="http://rtsc.eclipse.org/cdoc-tip/index.html ">XDCtools packages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-lists'>
		<h5>lists</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Master-doc-map"><a href="../Special:DocMap/Special:DocMap__Main_Page.html">Master doc-map</a></li>
				<li id="n-Category-query"><a href="../Special:Cats/Special:Cats.html">Category query</a></li>
				<li id="n-Redirected-pages"><a href="../Special:Listredirects/Special:Listredirects.html">Redirected pages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-tools'>
		<h5>tools</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Find.2BReplace-.28grep.29"><a href="../Special:Grep/Special:Grep.html">Find+Replace (grep)</a></li>
				<li id="n-RSS-feed"><a href="http://rtsc.eclipse.orgmediawiki-tip/index.php?title=Special:Recentchanges&amp;feed=rss ">RSS feed</a></li>
			</ul>
		</div>
	</div>
		<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/docs-tip/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" type="text" title="Search RTSC-Pedia [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>more tools</h5>
		<div class="pBody">
			<ul>
<li id="t-upload"><a href="../Special:Upload/Special:Upload.html" title="Upload images or media files [u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="../Special:Specialpages/Special:Specialpages.html" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../common/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
				<li id="privacy"><a href="../RTSC-Pedia:Privacy_policy/RTSC-Pedia:Privacy_policy.html" title="RTSC-Pedia:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="../RTSC-Pedia:About/RTSC-Pedia:About.html" title="RTSC-Pedia:About">About RTSC-Pedia</a></li>
				<li id="disclaimer"><a href="../RTSC-Pedia:General_disclaimer/RTSC-Pedia:General_disclaimer.html" title="RTSC-Pedia:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
		
	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served in 0.243 secs. --></body></html>
