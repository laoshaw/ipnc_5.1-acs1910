<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
				<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="mediawiki-tip/opensearch_desc.php" title="RTSC-Pedia (English)" />
		<title>RTSC Module Primer/Lesson 8 - Offline Version</title>
		<style type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "../common/skins/common/shared.css";
			@import "../common/skins/monobook/main.css";
		/*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="../common/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "../common/skins/monobook/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "../common/skins/monobook/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "../common/skins/monobook/IE70Fixes.css";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="../common/skins/common/IEFixes.js?97"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		
		<script type= "text/javascript">/*<![CDATA[*/
var skin = "monobook";
var stylepath = "../common/skins";
var wgArticlePath = "/docs-tip/$1";
var wgScriptPath = "mediawiki-tip";
var wgScript = "mediawiki-tip/index.php";
var wgServer = "http://rtsc.eclipse.org";
var wgCanonicalNamespace = "Special";
var wgCanonicalSpecialPageName = "Offline";
var wgNamespaceNumber = -1;
var wgPageName = "Special:Offline";
var wgTitle = "Offline";
var wgAction = "view";
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
var wgArticleId = 0;
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = 0;
/*]]>*/</script>
                
		<script type="text/javascript" src="../common/skins/common/wikibits.js?97"><!-- wikibits js --></script>
		<script type="text/javascript" src="mediawiki-tip/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "mediawiki-tip/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "mediawiki-tip/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
<link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/ViewStyle.css" /><link rel="stylesheet" type="text/css" href="../common/extensions/rtsc/MainStyle.css" />
	</head>
<body  class="mediawiki ns--1 ltr page-Special_Offline">
	<div id="globalWrapper" align="center">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading"></h1>
		<div id="bodyContent">
			<h3 id="siteSub">From RTSC-Pedia</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content --><div id="revInfo">revision tip</div><span id="printInfo">&#151;&#151;&nbsp;LANDSCAPE orientation</span><table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/green_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=RTSC Module Primer/Lesson 8&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="RTSC_Module_Primer__Lesson_7.html" title="Lesson 7"><img src="../common/extensions/rtsc/images/Arrow_left.png" /></a>&nbsp;<a href="RTSC_Module_Primer.html#TOC" title="RTSC Module Primer"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a>&nbsp;<a href="RTSC_Module_Primer__Lesson_9.html" title="Lesson 9"><img src="../common/extensions/rtsc/images/Arrow_right.png" /></a></td></tr></table><p id="title">RTSC Module Primer/Lesson 8</p><p id="subtitle">Instance modules &#151; implementing <tt>bravo.math.RandGen</tt></p>
<p>Unlike the other modules we've just examined, the <tt>RandGen</tt> module supports creation and deletion of <i>instances objects</i> which here represent independently parameterized sequences of random-numbers.  First used within client programs back in <a href="RTSC_Module_Primer__Lesson_3.html#Reading_the_program" title="RTSC Module Primer/Lesson 3">Lesson 3</a> and <a href="RTSC_Module_Primer__Lesson_4.html#Reading_the_program" title="RTSC Module Primer/Lesson 4">Lesson 4</a>, we'll now revisit <tt>RandGen</tt> from the perspective of its supplier&#151;all while extending some of the programming idioms already encountered in the last two lessons to now handle instance objects throughout their life-cycle.
</p>
<div class="Info"><p class="Info">You might find it helpful to first review the client programming idioms used with <i>any</i> RTSC instance module by quickly glancing at the <tt>prog.c</tt> and <tt>prog.cfg</tt> examples in <a href="RTSC_Module_Primer__Lesson_3.html#Reading_the_program" title="RTSC Module Primer/Lesson 3">Lesson 3</a> and <a href="RTSC_Module_Primer__Lesson_4.html#Reading_the_program" title="RTSC Module Primer/Lesson 4">Lesson 4</a>.</p></div>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Specifying_the_module"><span class="tocnumber">1</span> <span class="toctext">Specifying the module</span></a></li>
<li class="toclevel-1"><a href="#Implementing_the_module_.28target-domain.29"><span class="tocnumber">2</span> <span class="toctext">Implementing the module (target-domain)</span></a></li>
<li class="toclevel-1"><a href="#Implementing_the_module_.28meta-domain.29"><span class="tocnumber">3</span> <span class="toctext">Implementing the module (meta-domain)</span></a></li>
<li class="toclevel-1"><a href="#Building_the_package"><span class="tocnumber">4</span> <span class="toctext">Building the package</span></a></li>
<li class="toclevel-1"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Specifying_the_module"></a><h2> <span class="mw-headline">Specifying the module</span></h2>
<p>Like the <tt>Bench</tt> module of <a href="RTSC_Module_Primer__Lesson_7.html#Specifying_the_module" title="RTSC Module Primer/Lesson 7">Lesson 7</a>, the <tt>RandGen.xdc</tt> spec uses the <span class="kw1"><tt>internal</tt></span> keyword to delineate <i>private</i> declarations supporting the module's implementation.  But unlike <tt>Bench</tt>, <tt>RandGen.xdc</tt> also employs the new <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> <span class="kw1"><tt>instance</tt></span> keyword to further demarcate (client-visible) <i>public</i> declarations that only pertain to instance objects. 
</p>
<table>

<tr>
<td><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>bravo/math/package.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="xdoc">/*! Collection of math modules */</span>
<span class="kw1">package</span> bravo.math <span class="br0">&#123;</span>
    <span class="kw1">module</span> RandGen;
<span class="br0">&#125;</span>;</pre></td></tr></table>
</td></tr>
<tr>
<td>&nbsp;
</td></tr>
<tr>
<td><div id="cl-1:1"></div><div id="cl-1:2"></div><div id="cl-1:3a"></div><div id="cl-1:3b"></div><div id="cl-1:4a"></div><div id="cl-1:4b"></div><div id="cl-1:5"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>bravo/math/RandGen.xdc</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">1&nbsp;</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2&nbsp;</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3a</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3b</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4a</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">4b</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">5&nbsp;</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcspec"><span class="xdoc">/*! Random-number sequence generator */</span>
<span class="kw1">module</span> RandGen <span class="br0">&#123;</span>
&nbsp;
    <span class="xdoc">/*! Largest possible number in a sequence */</span>
    <span class="kw1">const</span> <span class="kw2">Int16</span> MAXVALUE = <span class="br0">&#40;</span>1U &lt;&lt; <span class="nu0">15</span><span class="br0">&#41;</span> - <span class="nu0">1</span>;
&nbsp;
<span class="kw1">instance</span>:
&nbsp;
    <span class="kw2">create</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
    <span class="xdoc">/*! Numbers between (0, `range`] */</span>
    <span class="kw1">config</span> <span class="kw2">Int16</span> range = MAXVALUE;
&nbsp;
    <span class="xdoc">/*! Random-number seed value */</span>
    <span class="kw1">config</span> <span class="kw2">UInt</span> seed = <span class="nu0">1</span>;
&nbsp;
    <span class="xdoc">/*! Generate the next number in this sequence */</span>
    <span class="kw2">Int16</span> next<span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
    <span class="xdoc">/*! Generate the next `count` numbers in this sequence
     *
     *  @param(buffer) output buffer
     *  @param(count) number of numbers
     */</span>
    <span class="kw2">Void</span> nextn<span class="br0">&#40;</span><span class="kw2">Int16</span> *buffer, <span class="kw2">Int</span> count<span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">internal</span>:    
&nbsp;
    <span class="kw1">struct</span> Instance_State <span class="br0">&#123;</span>
        <span class="kw2">Int16</span> range;      <span class="coMULTI">/* range parameter value */</span>
        <span class="kw2">ULong</span> next;       <span class="coMULTI">/* next value in sequence */</span>
    <span class="br0">&#125;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
</td></tr></table>
<div class="Info"><p class="Info">Recalling our note about RTSC standard types back in <a href="RTSC_Module_Primer__Lesson_3.html#Standard_Types" title="RTSC Module Primer/Lesson 3">Lesson 3</a>, the type <span class="kw2"><tt>Int16</tt></span> implies <i>at least</i> 16-bits of range and may in fact be larger on certain targets.  While we strongly recommend use of RTSC standard types like <span class="kw2"><tt>Void</tt></span> and <span class="kw2"><tt>ULong</tt></span>, <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> also recognizes legacy C types such as <tt>void</tt> and <tt>unsigned</tt> <tt>long</tt>.</p></div> 
<p>Working down the page, the <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> constant declaration at line <a class="codexLink" href="#cl-1:1"><span class="codexLink">1</span></a> of <tt>RandGen.xdc</tt>&#151;familiar syntax to any C programmer&#151;applies <i>module-wide</i> rather than on a <i>per-instance</i> basis.  In object-oriented languages such as C++ or Java, you typically distinguish such declarations through use of the <span class="kw1"><tt>static</tt></span> keyword; but because of the inherently object-<i><b>dis</b></i>oriented nature of C&#151;the implementation language of choice amongst embedded programmers&#151;<tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> has chosen the opposite approach by instead introducing its own <tt>instance</tt> keyword as a marker.
</p><p>In general, you'll find that all <i>per-instance</i> declarations&#151;those following the <span class="kw1"><tt>instance</tt></span> keyword&#151; feel somewhat "incomplete" when seen against typical usage of <tt>RandGen</tt> configs and functions in the <tt>prog.c</tt> target-programs of <a href="RTSC_Module_Primer__Lesson_3.html#Reading_the_program" title="RTSC Module Primer/Lesson 3">Lesson 3</a> or <a href="RTSC_Module_Primer__Lesson_4.html#Reading_the_program" title="RTSC Module Primer/Lesson 4">Lesson 4</a>:
</p>
<ul><li> the special <span class="kw2"><tt>create</tt></span> declaration at line <a class="codexLink" href="#cl-1:2"><span class="codexLink">2</span></a> lacks any type information, even though the function takes several stock arguments and returns a <tt>RandGen_Handle</tt>;
</li></ul>
<p></p>
<ul><li> the per-instance configs spec'd at lines <a class="codexLink" href="#cl-1:3a"><span class="codexLink">3a</span></a> and <a class="codexLink" href="#cl-1:3b"><span class="codexLink">3b</span></a> should seemingly be declared as corresponding fields inside of a special <tt>RandGen_Params</tt> structure;
</li></ul>
<p></p>
<ul><li> the per-instance functions declared at lines <a class="codexLink" href="#cl-1:4a"><span class="codexLink">4a</span></a> and <a class="codexLink" href="#cl-1:4b"><span class="codexLink">4b</span></a> have no explicit declaration of their first argument of type <tt>RandGen_Handle</tt>; and
</li></ul>
<p></p>
<ul><li> explict declarations of special functions like <tt>RandGen_Params_init</tt>, <tt>RandGen_construct</tt>, <tt>RandGen_destruct</tt>, and <tt>RandGen_delete</tt> are missing altogether.
</li></ul>
<p>Given the pattern-like regularity of the programming idioms used with any RTSC instance module, <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> chooses instead to allow suppliers of such modules to focus on declaring their module's <i>unique</i> per-instance features&#151;its configs and functions&#151;without regard for their exact binding in any particular programming language environment.  Axiomatic to RTSC, the <i>same</i> module spec already has a realization in the <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt>-based meta-domain as well as the C-based target-domain, taking on a somewhat different "look-and-feel" in each domain which ultimately reflects the underlying programming language.
</p>
<div class="Info"><p class="Info">The <tt>XDCtools</tt> product includes an interactive documentation-generation tool for RTSC packages named <tt>xdc.tools.cdoc.sg</tt> which you can invoke using the standard <tt>xs</tt> command.  Leveraging XDoc comments embedded in module <tt>.xdc</tt> files contained in each package found along the RTSC <b>package path</b>&#151;the directories comprising the <tt>XDCPATH</tt> environment variable set back in <a href="RTSC_Module_Primer__Lesson_0.html#Assigning_environment_variables" title="RTSC Module Primer/Lesson 0">Lesson 0</a> together with the special <tt><span class="mq">&laquo;</span>xdcroot<span class="mq">&raquo;</span>/packages</tt> directory&#151;the <tt>cdoc</tt> tool presents distinct target-domain and meta-domain <i>views</i> of an otherwise common module spec file, in terms more meaningful to the client-side programmer.  In the case of the C-centric target-domain view, the <tt>cdoc.sg</tt> tool here fills-in all the seemingly "missing" programmatic information absent from the underlying <tt>.xdc</tt> file.</p></div> 
<p>Unlike the other per-instance functions specified in <tt>RandGen.xdc</tt>&#151;which each operate on a previously created instance object, passed through an extra argument of type <tt>RandGen_Handle</tt> in C&#151;the declaration of <span class="kw2"><tt>create</tt></span> at line <a class="codexLink" href="#cl-1:2"><span class="codexLink">2</span></a> seems unnecessary and even somewhat misplaced.  As it turns out, <i>all</i> of the special functions used throughout the instance object life-cycle&#151;including <tt>RandGen_create</tt>, with its stock signature&#151;would still be defined for the <tt>RandGen</tt> module even with line <a class="codexLink" href="#cl-1:2"><span class="codexLink">2</span></a> omitted from the spec.  We've elected to explicitly mention <span class="kw2"><tt>create</tt></span> here, in part to remind us of the seminal role this function plays when working with instance objects in RTSC; but also (as we will see in a new module introduced in the next lesson) to suggest that the corresponding <tt><i>Mod</i>_create</tt> may require <i>additional</i> arguments at the discretion of the module supplier.
</p><p>Looking past the <span class="kw1"><tt>internal</tt></span> keyword, the <span class="kw1"><tt>struct</tt></span> declaration of <tt>Instance_State</tt> at line <a class="codexLink" href="#cl-1:5"><span class="codexLink">5</span></a> of <tt>RandGen.xdc</tt> plays a similar role to the <tt>Module_State</tt> structure used earlier by <tt>Bench</tt> in <a href="RTSC_Module_Primer__Lesson_7.html#Specifying_the_module" title="RTSC Module Primer/Lesson 7">Lesson 7</a>&#151;both specify internal state variables used in this module's implementation by declaring fields of a well-known <tt>struct</tt>.  Unlike the <tt>Bench</tt> module, however, the implementation of <tt>RandGen</tt> relies only upon <i>per-instance</i> state&#151;a fresh set of internal variables automatically associated with each instance object upon creation.
</p>
<div class="Info"><p class="Info">Many of the new concepts introduced in <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt>&#151;such as "internal per-instance state variables"&#151;have clear parallels in the world of object-oriented programming, where languages like C++ or Java have explicit support for controlling visibility of class members on a per-function or per-field basis through keywords like <span class="kw1"><tt>public</tt></span> or <span class="kw1"><tt>private</tt></span>; as noted earlier, these languages already use the <span class="kw1"><tt>static</tt></span> keyword to designate class members that remain common all instances&#151;equivalent in concept to module-wide declarations in RTSC.  Over time, perhaps, the same <tt class="color-green" style="font-size:110%; font-weight:bold;">XDCspec</tt> source file might yield bindings for other target languages such as C++ (arguably more expressive when working with instance objects in general, though certainly less widespread than C inside the embedded programming community).</p></div>
<a name="Implementing_the_module_.28target-domain.29"></a><h2> <span class="mw-headline">Implementing the module (target-domain)</span></h2>
<p>The target-implementation found in <tt>RandGen.c</tt> reveals many of the "missing" details in the <tt>RandGen.xdc</tt> spec, such as the extra argument passed to each per-instance function or the <tt>Params</tt> structure used to collect per-instance config values during creation.
</p>
<div id="cl-2:1"></div><div id="cl-2:2"></div><div id="cl-2:3"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>bravo/math/RandGen.c</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br /><span class="codexLab">1</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="c"><span class="re1">#include</span> <span class="st0">&quot;package/internal/RandGen.xdc.h&quot;</span>
&nbsp;
<span class="kw2">Void</span> RandGen_Instance_init<span class="br0">&#40;</span>RandGen_Object *obj, const RandGen_Params *params<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    obj-&gt;range = params-&gt;range;
    obj-&gt;next = params-&gt;seed;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">Int16</span> RandGen_next<span class="br0">&#40;</span>RandGen_Object *obj<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="coMULTI">/* randomize and retain the next sequence value */</span>
    obj-&gt;next = obj-&gt;next * <span class="nu0">1103515245</span> + <span class="nu0">12345</span>;
&nbsp;
    <span class="coMULTI">/* scale the result to within the sequence's parameterized range */</span>
    <span class="kw1">return</span> <span class="br0">&#40;</span><span class="kw2">Int16</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="br0">&#40;</span>obj-&gt;next / <span class="br0">&#40;</span>RandGen_MAXVALUE + <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>&nbsp;% <span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw2">ULong</span><span class="br0">&#41;</span>obj-&gt;range + <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">Void</span> RandGen_nextn<span class="br0">&#40;</span>RandGen_Object *obj, <span class="kw2">Int16</span> *buffer, <span class="kw2">Int</span> count<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw2">Int</span> i;
&nbsp;
    <span class="coMULTI">/* fill the buffer through repeated calls to RandGen_next */</span>
    <span class="kw1">for</span> <span class="br0">&#40;</span>i = <span class="nu0">0</span>; i &lt; count; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        *buffer++ = RandGen_next<span class="br0">&#40;</span>obj<span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></table>
<p>The special target function defined at line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> effectively serves as a common "back-end" for any client-side calls to <tt>RandGen_create</tt> or <tt>RandGen_construct</tt> at runtime.  Passed a pointer to a fresh <tt>RandGen_Object</tt> structure&#151;whose field names match those of <tt>Instance_State</tt> declared at line <a class="codexLink" href="#cl-1:5"><span class="codexLink">5</span></a> of <tt>RandGen.xdc</tt>&#151;the module's special <tt>RandGen_Instance_init</tt> function assumes general responsbility for initializing the set of per-instance state variables associated with this newly created object.  Once initialized, these very same <tt>RandGen_Object</tt> structures re-enter the module's target-implementation as first arguments of all per-instance functions (like <tt>RandGen_next</tt> at line <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a> or <tt>RandGen_nextn</tt> at line <a class="codexLink" href="#cl-2:3"><span class="codexLink">3</span></a>) where these internal structures become subject to further access and update. 
</p>
<div class="Info"><p class="Info">Unlike the <tt><i>Mod</i>_Handle</tt> or <tt><i>Mod</i>_Struct</tt> types respectively returned by <tt><i>Mod</i>_create</tt> and passed to <tt><i>Mod</i>_construct</tt>&#151;<i>opaque</i> types from the client's perspective whose internal representation remains hidden&#151;everything becomes transparent with the concrete <tt><i>Mod</i>_Object</tt> structures manipulated directly inside the module's implementation.  In reality, <tt><i>Mod</i>_Handle</tt> is no more than a <tt>typedef</tt> for <tt><i>Mod</i>_Object*</tt> (and <tt><i>Mod</i>_Struct</tt> is just an amorphous block of memory at least as large as a concrete <tt><i>Mod</i>_Object</tt>); and yet, to emphasize the all-important client-supplier dichotomy within RTSC, we will avoid direct use of a module's (internal) <tt><i>Mod</i>_Object</tt> type outside of its implementation.</p></div>     
<p>Continuing with the instance creation pattern from the supplier's perspective, any <tt><i>Mod</i>_Instance_init</tt> function will also accept a reference to a (readonly) <tt><i>Mod</i>_Params</tt> structure whose client-assignable fields&#151;the module's per-instance configs&#151;often play an important role in shaping the newly created instance object.  Since the client will often declare <i>local</i> variables of type <tt><i>Mod</i>_Params</tt> before calling <tt><i>Mod</i>_create</tt> or <tt><i>Mod</i>_construct</tt>, the body of <tt><i>Mod</i>_Instance_init</tt> must often retain certain of its per-instance configs in corresponding state variables for later access in the instance life-cycle&#151;as is the case at line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> of <tt>RandGen.c</tt>.  Note also that <tt><i>Mod</i>_Instance_init</tt> receives a special <tt><i>Mod</i>_Params</tt> structure initialized with the spec'd defaults for each per-instance config whenever client passes <tt>NULL</tt> as the corresponding argument to <tt><i>Mod</i>_create</tt> or <tt><i>Mod</i>_construct</tt>. 
</p>
<div class="Info"><p class="Info">Working in C++ or Java, functions like <tt>RandGen_Instance_init</tt> would become <i>constructors</i> for a corresponding class&#151;responsible for initializing the state of a newly-allocated instance object belonging to this class.  Following this pattern, the built-in <tt>new</tt> operator would supplant client calls to functions like <tt>RandGen_create</tt>.</p></div>
<a name="Implementing_the_module_.28meta-domain.29"></a><h2> <span class="mw-headline">Implementing the module (meta-domain)</span></h2>
<p>Turning now to the meta-implementation of <tt>RandGen</tt>, we once again introduce another special <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> function used here to initialize the state of any <tt>RandGen</tt> instance objects created statically during program configuration.
</p>
<div id="cl-2:4"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>bravo/math/RandGen.xs</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab"><span class="codexLab">4</span><br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">function</span> instance$static$init<span class="br0">&#40;</span>obj, params<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    obj.range = params.range;
    obj.next = params.seed;
<span class="br0">&#125;</span></pre></td></tr></table>
<p>Seeing past some obvious syntactic differences between <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> and C, the <tt>instance$static$init</tt> function defined at line <a class="codexLink" href="#cl-2:4"><span class="codexLink">4</span></a> of <tt>RandGen.xs</tt> becomes a configuration-time <i>clone</i> of the runtime <tt>RandGen_Instance_init</tt> function defined at line <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> of <tt>RandGen.c</tt>.  Similar to how <tt>Bench</tt> used <tt>module$static$init</tt> in <a href="RTSC_Module_Primer__Lesson_7.html#Implementing_the_module_.28meta-domain.29" title="RTSC Module Primer/Lesson 7">Lesson 7</a> to statically initialize its module-wide state, the <tt>instance$static$init</tt> function at line <a class="codexLink" href="#cl-2:4"><span class="codexLink">4</span></a> would here yield a statically-initialized <tt>RandGen_Object</tt> structure in the target-domain.
</p><p>Unlike initialization of module-wide state&#151;which occurs just once in the meta-domain, barring any supplemental processing required at program startup&#151;initialization of per-instance state objects can occur multiple times and in either domain.  With clients of the <tt>RandGen</tt> module able to repeatedly call <tt>RandGen.create</tt> in the meta-domain as well as <tt>RandGen_create</tt> (or <tt>RandGen_construct</tt>) in the target-domain, the supplier of <tt>RandGen</tt> must effectively provide <i>two</i> implementations of the same back-end functionality to support instance creation in general.
</p>
<a name="Building_the_package"></a><h2> <span class="mw-headline">Building the package</span></h2>
<p>Like the <tt>acme.utils</tt> package examined in <a href="RTSC_Module_Primer__Lesson_6.html#Building_the_package" title="RTSC Module Primer/Lesson 6">Lesson 6</a>, the <tt>bravo.math</tt> package only builds libraries; you'll find sample client programs that consume this package back in <a href="RTSC_Module_Primer__Lesson_3.html#Reading_the_program" title="RTSC Module Primer/Lesson 3">Lesson 3</a> and <a href="RTSC_Module_Primer__Lesson_4.html#Reading_the_program" title="RTSC Module Primer/Lesson 4">Lesson 4</a>.  The build script for this package contains one minor twist, however.
</p>
<div id="cl-3:1"></div><div id="cl-3:2"></div><div id="cl-3:3"></div><table cellpadding="0" cellspacing="0" class="codex"><tr><td class="codexLab"></td><td class="codexName"><tt>bravo/math/package.bld</tt></td></tr><tr class="codex"><td class="codexLab"><tt class="codexLab">&nbsp;<br />&nbsp;<br />&nbsp;<br /><span class="codexLab">1</span><br /><span class="codexLab">2</span><br />&nbsp;<br />&nbsp;<br /><span class="codexLab">3</span><br />&nbsp;<br /></tt></td><td class="codexBody"><pre class="xdcscript"><span class="kw1">var</span> Build = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.BuildEnvironment'</span><span class="br0">&#41;</span>;
<span class="kw1">var</span> Pkg = <span class="re1">xdc.useModule</span><span class="br0">&#40;</span><span class="st1">'xdc.bld.PackageContents'</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">var</span> LIB_NAME = <span class="st0">&quot;lib/&quot;</span> + Pkg.name;
<span class="kw1">var</span> LIB_SRCS = <span class="br0">&#91;</span><span class="st0">&quot;RandGen.c&quot;</span><span class="br0">&#93;</span>;
&nbsp;
<span class="kw1">for</span> <span class="kw1">each</span> <span class="br0">&#40;</span><span class="kw1">var</span> targ <span class="kw1">in</span> Build.targets<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Pkg.addLibrary<span class="br0">&#40;</span>LIB_NAME, targ<span class="br0">&#41;</span>.addObjects<span class="br0">&#40;</span>LIB_SRCS<span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre></td></tr></table>
<p>As programmers, we're continually reminded to avoid placing arbitrary constants in the middle of executable code and instead to define meaningful symbolic names at the top of our source files; we've done just that at lines <a class="codexLink" href="#cl-2:1"><span class="codexLink">1</span></a> and <a class="codexLink" href="#cl-2:2"><span class="codexLink">2</span></a> of <tt>package.bld</tt>.  Besides improving the readability of line <a class="codexLink" href="#cl-2:3"><span class="codexLink">3</span></a>, this technique simplifies the maintenance of more complex build scripts that contain multiple module source files or perhaps more that one named library for each target.
</p>
<div class="Info"><p class="Info">Lest we forget, <tt>package.bld</tt> <i>is</i> a program (albeit one that executes in the meta-domain) and <tt class="color-red" style="font-size:110%; font-weight:bold;">XDCscript</tt> <i>is</i> a general-purpose programming language.  But that's a good thing, since we can now apply the same sorts of techniques we already know from working with C to keep our source code simple yet flexible.</p></div>
<a name="See_also"></a><h2> <span class="mw-headline">See also</span></h2>
<p></p>
<table id="TOC" class="DocList">

<tr>
<td class="DocListTitle1" style="width:35%;"><a href="../C_-_Instance_init/C_-_Instance_init.html" title="C - Instance init">C - Instance_init</a>
</td><td class="DocListSubTitle1">Module's instance initialization function
</td></tr>
<tr>
<td class="DocListTitle" style="width:35%;"><a href="../Command_-_xdc.tools.cdoc.sg/Command_-_xdc.tools.cdoc.sg.html" title="Command - xdc.tools.cdoc.sg">Command - xdc.tools.cdoc.sg</a>
</td><td class="DocListSubTitle">Interactive package documentation tool
</td></tr>
<tr>
<td class="DocListTitle" style="width:35%;"><a href="../XDCscript_-_Instance-Body.instance%24static%24init/XDCscript_-_Instance-Body.instance%24static%24init.html" title="XDCscript - Instance-Body.instance$static$init">XDCscript - Instance-Body.instance$static$init</a>
</td><td class="DocListSubTitle">Statically initialize a target module's instance object
</td></tr></table>
<p></p>
<table width="100%"><tr><td class="lights"><img src="../common/extensions/rtsc/images/green_light.png" /></td><td class="offline">[<a href="/mediawiki-tip/index.php?title=RTSC Module Primer/Lesson 8&amp;printable=yes" title="just this page in black-and-white, ready for printing in landscape orientation">printable version</a>]&nbsp;&nbsp;</td><td class="offlineDate">offline version generated on 02-Oct-2009 22:10 UTC</td><td class="arrows"><a href="RTSC_Module_Primer__Lesson_7.html" title="Lesson 7"><img src="../common/extensions/rtsc/images/Arrow_left.png" /></a>&nbsp;<a href="RTSC_Module_Primer.html#TOC" title="RTSC Module Primer"><img src="../common/extensions/rtsc/images/Arrow_up.png" /></a>&nbsp;<a href="RTSC_Module_Primer__Lesson_9.html" title="Lesson 9"><img src="../common/extensions/rtsc/images/Arrow_right.png" /></a></td></tr></table><div id=copyInfo>Copyright &#169; 2008 The Eclipse Foundation. All Rights Reserved</div>
<!-- 
Pre-expand include size: 13203 bytes
Post-expand include size: 4185 bytes
Template argument size: 459 bytes
Maximum: 2097152 bytes
-->

			<div class="printfooter">
Retrieved from "<a href="http://rtsc.eclipse.org/docs-tip/Special:Offline">http://rtsc.eclipse.org/docs-tip/Special:Offline</a>"</div>
						<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
					 <li id="ca-nstab-special" class="selected"><a href="../Special:Offline/Special:Offline__RTSC_Module_Primer.html" title="This is a special page, you can't edit the page itself">Special</a></li>
				</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="mediawiki-tip/index.php?title=Special:Userlogin&amp;returnto=Special:Offline" title="You are encouraged to log in, it is not mandatory however. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(../common/extensions/rtsc/images/logo.png);" href="/docs-tip/Main_Page" title="Visit the Main Page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-RTSC-pedia-home"><a href="../Main_Page/Main_Page.html">RTSC-pedia home</a></li>
				<li id="n-RTSC-project-home"><a href="http://rtsc.eclipse.org ">RTSC project home</a></li>
				<li id="n-News-.26-support"><a href="http://www.eclipse.org/newsportal/thread.php?group=eclipse.dsdp.rtsc">News &amp; support</a></li>
				<li id="n-Help"><a href="../Help:Contents/Help:Contents.html">Help</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-binders'>
		<h5>binders</h5>
		<div class='pBody'>
			<ul>
				<li id="n-General-Information"><a href="../General_Information/General_Information.html">General Information</a></li>
				<li id="n-RTSC-Programming"><a href="../RTSC_Programming/RTSC_Programming.html">RTSC Programming</a></li>
				<li id="n-User.27s-Guide"><a href="../XDCtools_User%27s_Guide/XDCtools_User%27s_Guide.html">User's Guide</a></li>
				<li id="n-Reference-Manual"><a href="../XDCtools_Reference_Manual/XDCtools_Reference_Manual.html">Reference Manual</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-package_reference'>
		<h5>package reference</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XDCtools-packages"><a href="http://rtsc.eclipse.org/cdoc-tip/index.html ">XDCtools packages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-lists'>
		<h5>lists</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Master-doc-map"><a href="../Special:DocMap/Special:DocMap__Main_Page.html">Master doc-map</a></li>
				<li id="n-Category-query"><a href="../Special:Cats/Special:Cats.html">Category query</a></li>
				<li id="n-Redirected-pages"><a href="../Special:Listredirects/Special:Listredirects.html">Redirected pages</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-tools'>
		<h5>tools</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Find.2BReplace-.28grep.29"><a href="../Special:Grep/Special:Grep.html">Find+Replace (grep)</a></li>
				<li id="n-RSS-feed"><a href="http://rtsc.eclipse.orgmediawiki-tip/index.php?title=Special:Recentchanges&amp;feed=rss ">RSS feed</a></li>
			</ul>
		</div>
	</div>
		<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/docs-tip/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" type="text" title="Search RTSC-Pedia [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>more tools</h5>
		<div class="pBody">
			<ul>
<li id="t-upload"><a href="../Special:Upload/Special:Upload.html" title="Upload images or media files [u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="../Special:Specialpages/Special:Specialpages.html" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../common/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
				<li id="privacy"><a href="../RTSC-Pedia:Privacy_policy/RTSC-Pedia:Privacy_policy.html" title="RTSC-Pedia:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="../RTSC-Pedia:About/RTSC-Pedia:About.html" title="RTSC-Pedia:About">About RTSC-Pedia</a></li>
				<li id="disclaimer"><a href="../RTSC-Pedia:General_disclaimer/RTSC-Pedia:General_disclaimer.html" title="RTSC-Pedia:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
		
	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served in 0.243 secs. --></body></html>
